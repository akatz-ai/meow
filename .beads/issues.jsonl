{"id":"meow-e1","title":"Foundation: Project setup and core infrastructure","description":"Establish the foundational infrastructure for MEOW Stack including project\nstructure, core types, CLI skeleton, and build system.\n","notes":"## Why This Epic Matters\n\nA solid foundation prevents technical debt. Every component depends on\nthese core types and patterns. Getting this right saves refactoring later.\n\n## Deliverables\n1. Go project structure with modules\n2. Core types (Bead, Agent, Template, Config)\n3. CLI skeleton using Cobra\n4. Build system (Makefile)\n5. Basic configuration handling\n\n## Success Criteria\n- `go build` produces working `meow` binary\n- `meow --version` and `meow --help` work\n- Core types are defined and usable\n- Basic project structure matches architecture doc\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-07T03:12:48.457391798-05:00","updated_at":"2026-01-07T03:12:48.457391798-05:00","labels":["epic","foundation","phase-1"]}
{"id":"meow-e1.1","title":"Initialize Go project with module structure","description":"Create the Go project structure for MEOW Stack.","notes":"## Directory Structure\n```\nmeow-machine/\n├── cmd/meow/                  # CLI entry point\n├── internal/\n│   ├── config/               # Configuration handling\n│   ├── types/                # Core data types\n│   ├── orchestrator/         # Orchestrator engine\n│   ├── template/             # Template system\n│   ├── agent/                # Agent management\n│   └── primitive/            # Primitive handlers\n├── pkg/meow/                 # Public API (if needed)\n├── templates/                # Default templates (embedded)\n├── go.mod\n├── Makefile\n└── README.md\n```\n\n## Commands\n```bash\ngo mod init github.com/your-org/meow-machine\nmkdir -p cmd/meow internal/{config,types,orchestrator,template,agent,primitive}\n```\n\n## Acceptance Criteria\n- [ ] `go mod init` creates valid go.mod\n- [ ] Directory structure matches plan\n- [ ] `.gitignore` includes Go artifacts\n- [ ] Basic `main.go` compiles\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["foundation","setup"]}
{"id":"meow-e1.2","title":"Define core data types (Bead, Agent, Template, Config)","description":"Define the fundamental data structures used throughout MEOW.","notes":"## Types to Define\n\n### Bead (internal/types/bead.go)\n- BeadType enum (task, condition, stop, start, code, expand) - 6 primitives\n- BeadStatus enum (open, in_progress, closed)\n- Bead struct with all fields\n- Primitive-specific spec structs (ConditionSpec, StartSpec, CodeSpec, etc.)\n- OutputSpec for code bead outputs (stdout, file capture)\n- TaskOutputSpec for required/optional task outputs with types\n- EphemeralFlag for cleanup behavior\n\n### Agent (internal/types/agent.go)\n- AgentStatus enum (active, stopped)\n- Agent struct with session tracking\n- Session ID storage (for resume composition)\n\n### Config (internal/config/config.go)\n- Config struct for TOML loading\n- DefaultsConfig for default values\n- EphemeralCleanup settings\n\n## Design Decisions\n\n**Why 6 primitives instead of 8?**\ncheckpoint and resume are now composed from code + start:\n- checkpoint → code bead running `meow session-id`\n- resume → start bead with `resume_session` parameter\n\n**Why separate spec structs?**\nEach primitive has different fields. Using embedded structs keeps the\nmain Bead type clean while allowing type-safe access.\n\n## Acceptance Criteria\n- [ ] All types compile without errors\n- [ ] JSON marshaling/unmarshaling works correctly\n- [ ] OutputSpec handles stdout, stderr, file capture\n- [ ] TaskOutputSpec handles required/optional with types\n- [ ] Types have appropriate comments/godoc\n- [ ] Unit tests for marshaling edge cases\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["foundation","types"],"dependencies":[{"issue_id":"meow-e1.2","depends_on_id":"meow-e1.1","type":"blocks","created_at":"2026-01-07T03:14:29.867045093-05:00","created_by":"ubuntu"}]}
{"id":"meow-e1.3","title":"Create CLI skeleton with Cobra","description":"Set up the CLI framework using Cobra with stub commands.","notes":"## Commands to Stub\n\n### User Commands\n- `meow init` - Initialize .meow directory\n- `meow run \u003ctemplate\u003e` - Start workflow\n- `meow status` - Show current state\n- `meow approve [bead]` - Approve a gate\n- `meow reject [bead]` - Reject a gate\n\n### Agent Commands\n- `meow prime` - Show next task for agent\n- `meow close \u003cbead\u003e` - Close a task\n- `meow handoff` - Request context refresh\n\n### Debug Commands\n- `meow agents` - List agents\n- `meow trace` - Show execution trace\n- `meow validate \u003ctemplate\u003e` - Validate template\n\n## File Structure\n```\ncmd/meow/\n├── main.go\n├── root.go\n├── init.go\n├── run.go\n└── ...\n```\n\n## Acceptance Criteria\n- [ ] `meow --help` shows all commands\n- [ ] `meow \u003ccmd\u003e --help` shows command-specific help\n- [ ] `meow --version` shows version\n- [ ] Commands parse arguments correctly\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["cli","foundation"],"dependencies":[{"issue_id":"meow-e1.3","depends_on_id":"meow-e1.1","type":"blocks","created_at":"2026-01-07T03:14:29.973239873-05:00","created_by":"ubuntu"}]}
{"id":"meow-e1.4","title":"Create Makefile and build scripts","description":"Create build automation for the project.","notes":"## Makefile Targets\n- `build` - Build binary to bin/meow\n- `install` - Install to GOPATH/bin\n- `test` - Run all tests\n- `test-short` - Run short tests\n- `lint` - Run golangci-lint\n- `clean` - Remove artifacts\n- `generate` - Run go generate\n\n## Version Embedding\nUse ldflags to embed version from git tags:\n```makefile\nVERSION ?= $(shell git describe --tags --always --dirty)\nLDFLAGS := -ldflags \"-X main.version=$(VERSION)\"\n```\n\n## Acceptance Criteria\n- [ ] `make build` produces binary\n- [ ] `make test` runs tests\n- [ ] `make lint` runs linter\n- [ ] Version embedded correctly\n","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["build","foundation"],"dependencies":[{"issue_id":"meow-e1.4","depends_on_id":"meow-e1.1","type":"blocks","created_at":"2026-01-07T03:14:30.059554844-05:00","created_by":"ubuntu"}]}
{"id":"meow-e1.5","title":"Implement configuration loading and defaults","description":"Implement configuration file loading and sensible defaults.","notes":"## Config File Locations (priority order)\n1. `.meow/config.toml` (project-local)\n2. `~/.config/meow/config.toml` (user global)\n3. Built-in defaults\n\n## Default Configuration\n```toml\nversion = \"1\"\n\n[paths]\ntemplate_dir = \".meow/templates\"\nbeads_dir = \".beads\"\nstate_dir = \".meow/state\"\n\n[defaults]\nagent = \"claude-1\"\nstop_grace_period = 10\ncondition_timeout = \"1h\"\n\n[orchestrator]\npoll_interval = \"100ms\"\nheartbeat_interval = \"30s\"\n\n[cleanup]\nephemeral = \"on_complete\"  # on_complete | manual | never\n\n[logging]\nlevel = \"info\"  # debug | info | warn | error\nformat = \"json\"  # json | text\nfile = \".meow/state/meow.log\"\n```\n\n## Acceptance Criteria\n- [ ] Default config works with no file present\n- [ ] Project-local config overrides defaults\n- [ ] Unknown fields ignored (forward compatibility)\n- [ ] Invalid config produces helpful error\n- [ ] Unit tests for config loading edge cases\n","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["config","foundation"],"dependencies":[{"issue_id":"meow-e1.5","depends_on_id":"meow-e1.2","type":"blocks","created_at":"2026-01-07T03:14:30.149720604-05:00","created_by":"ubuntu"}]}
{"id":"meow-e1.6","title":"Implement structured logging infrastructure","description":"Set up structured logging for debugging and observability.","notes":"## Why Logging Matters\nMEOW orchestrates long-running workflows. When things go wrong, we need:\n- Clear timestamps for every action\n- Structured fields for filtering (agent, bead_id, action)\n- Log levels for verbosity control\n- File output for post-mortem analysis\n\n## Implementation\nUse zerolog or zap for structured JSON logging.\n\n## Log Levels\n- DEBUG: Variable substitution, bead state changes\n- INFO: Bead dispatch, agent spawn/stop, template expansion\n- WARN: Retries, timeouts, missing optional fields\n- ERROR: Validation failures, crashes, unrecoverable states\n\n## Log Fields (always include)\n```json\n{\n  \"ts\": \"2026-01-07T12:00:00Z\",\n  \"level\": \"info\",\n  \"msg\": \"Dispatching bead\",\n  \"bead_id\": \"bd-task-001\",\n  \"bead_type\": \"task\",\n  \"agent\": \"claude-1\",\n  \"workflow_id\": \"meow-run-001\"\n}\n```\n\n## Acceptance Criteria\n- [ ] Logger initialized from config\n- [ ] All major actions logged with context\n- [ ] Log rotation (max file size)\n- [ ] DEBUG level shows internal state\n- [ ] JSON format parseable by jq\n- [ ] Unit tests for log output format\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["foundation","logging"],"dependencies":[{"issue_id":"meow-e1.6","depends_on_id":"meow-e1.5","type":"blocks","created_at":"2026-01-07T03:14:30.240051401-05:00","created_by":"ubuntu"}]}
{"id":"meow-e1.7","title":"Define error types and codes","description":"Define structured error types for consistent error handling.","notes":"## Error Categories\n- **ConfigError**: Invalid config, missing required fields\n- **TemplateError**: Parse error, validation error, missing template\n- **BeadError**: Invalid state transition, missing dependency, cycle\n- **AgentError**: Spawn failed, session not found, timeout\n- **OutputError**: Type mismatch, missing required, validation failed\n- **IOError**: File not found, permission denied, disk full\n\n## Error Structure\n```go\ntype MeowError struct {\n    Code    string   // \"TMPL_PARSE_001\"\n    Message string   // Human-readable\n    Details map[string]any  // Context\n    Cause   error    // Wrapped error\n}\n```\n\n## Error Codes\n```\nCONFIG_001: Missing required field\nCONFIG_002: Invalid value type\nTMPL_001: Parse error\nTMPL_002: Validation error - missing field\nTMPL_003: Validation error - cycle detected\nBEAD_001: Invalid status transition\nBEAD_002: Dependency not satisfied\nAGENT_001: Session spawn failed\nAGENT_002: Session not found\nOUTPUT_001: Missing required output\nOUTPUT_002: Type validation failed\nOUTPUT_003: Bead ID not found\n```\n\n## Acceptance Criteria\n- [ ] All error types defined\n- [ ] Errors include context (bead_id, template, etc.)\n- [ ] Errors are JSON-serializable\n- [ ] CLI shows human-readable messages\n- [ ] Unit tests for error formatting\n","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["errors","foundation"],"dependencies":[{"issue_id":"meow-e1.7","depends_on_id":"meow-e1.2","type":"blocks","created_at":"2026-01-07T03:14:30.320856018-05:00","created_by":"ubuntu"}]}
{"id":"meow-e10","title":"CLI Completion: All commands","description":"Complete all CLI commands.","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-07T03:12:48.457391798-05:00","updated_at":"2026-01-07T03:12:48.457391798-05:00","labels":["cli","epic","phase-4"],"dependencies":[{"issue_id":"meow-e10","depends_on_id":"meow-e3","type":"blocks","created_at":"2026-01-07T03:14:35.199949701-05:00","created_by":"ubuntu"},{"issue_id":"meow-e10","depends_on_id":"meow-e4","type":"blocks","created_at":"2026-01-07T03:14:35.288380895-05:00","created_by":"ubuntu"},{"issue_id":"meow-e10","depends_on_id":"meow-e5","type":"blocks","created_at":"2026-01-07T03:14:35.379231928-05:00","created_by":"ubuntu"}]}
{"id":"meow-e10.1","title":"Implement meow init command","description":"Initialize .meow directory.","notes":"- Create directory structure\n- Copy default templates\n- Create config.toml\n- Setup Claude Code hooks\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["cli","init"]}
{"id":"meow-e10.2","title":"Implement meow run command","description":"Start workflow execution.","notes":"Usage: meow run \u003ctemplate\u003e [--var key=value]...\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["cli","run"],"dependencies":[{"issue_id":"meow-e10.2","depends_on_id":"meow-e3.4","type":"blocks","created_at":"2026-01-07T03:14:35.470072244-05:00","created_by":"ubuntu"}]}
{"id":"meow-e10.3","title":"Implement meow prime command","description":"Show next task for agent with required outputs.","notes":"## Behavior\n1. Read $MEOW_AGENT to identify current agent\n2. Find assigned ready bead\n3. Output formatted context including:\n   - Task title and description\n   - **Required outputs with types and descriptions**\n   - Example close command\n   - Recently completed beads (optional context)\n\n## Output Format\n```\n=== YOUR CURRENT TASK ===\nBead: bd-select-001\nTitle: Select next task to work on\n\nInstructions:\n  Run: bv --robot-triage\n  Pick the highest priority ready task.\n\nREQUIRED OUTPUTS when closing:\n  work_bead (bead_id): The bead ID to implement\n  rationale (string): Why you chose this bead\n\nExample:\n  meow close bd-select-001 \\\n    --output work_bead=bd-task-XXX \\\n    --output rationale=\"...\"\n\nRECENTLY COMPLETED:\n  bd-task-000 \"Setup project\" (closed 5m ago)\n```\n\n## Acceptance Criteria\n- [ ] Reads agent from environment\n- [ ] Finds ready bead for agent\n- [ ] Shows task details\n- [ ] **Shows required outputs if defined**\n- [ ] Shows example close command\n- [ ] Shows recently completed beads (optional)\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["cli","prime"],"dependencies":[{"issue_id":"meow-e10.3","depends_on_id":"meow-e7.4","type":"blocks","created_at":"2026-01-07T03:14:35.560130626-05:00","created_by":"ubuntu"}]}
{"id":"meow-e10.4","title":"Implement meow close command","description":"Close a task bead with optional validated outputs.","notes":"## Usage\n```bash\nmeow close \u003cbead-id\u003e\nmeow close \u003cbead-id\u003e --notes \"...\"\nmeow close \u003cbead-id\u003e --output key=value --output key2=value2\nmeow close \u003cbead-id\u003e --output-json '{\"key\": \"value\"}'\n```\n\n## Output Validation\nIf the bead has required outputs defined, the close command must:\n1. Check all required outputs are provided\n2. Validate output types (string, bead_id, file_path, etc.)\n3. Return error with helpful message if validation fails\n4. Store validated outputs on the bead\n\n## Example Error\n```\nError: Cannot close bd-select-001 - missing required outputs\n\nRequired outputs:\n  ✗ work_bead (bead_id): Not provided\n  ✗ rationale (string): Not provided\n\nUsage:\n  meow close bd-select-001 --output work_bead=\u003cbead_id\u003e --output rationale=\u003cstring\u003e\n```\n\n## Acceptance Criteria\n- [ ] Closes bead with status update\n- [ ] Supports --notes flag\n- [ ] **Supports --output key=value flags**\n- [ ] **Supports --output-json for complex outputs**\n- [ ] **Validates required outputs before closing**\n- [ ] **Returns helpful error for missing/invalid outputs**\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["cli","close"]}
{"id":"meow-e10.5","title":"Implement meow status command","description":"Show comprehensive workflow status.","notes":"## Usage\n```bash\nmeow status                 # Current workflow status\nmeow status --verbose       # Include all beads\nmeow status --json          # JSON output for scripting\nmeow status --watch         # Live updates\n```\n\n## Output Format\n```\n=== MEOW WORKFLOW STATUS ===\nWorkflow: work-loop (started 2h ago)\nTemplate: work-loop.toml\n\nAGENTS:\n  claude-1        active     (running for 45m)\n  claude-1-worker stopped    (completed 10m ago)\n\nBEADS:\n  Total: 15  Open: 3  In Progress: 1  Closed: 11\n\n  Currently executing:\n    → bd-task-005 \"Implement auth endpoint\" (claude-1, 5m)\n\n  Ready to execute:\n    • bd-task-006 \"Write integration tests\"\n    • bd-task-007 \"Update documentation\"\n\n  Recently closed:\n    ✓ bd-task-004 \"Setup database\" (2m ago)\n    ✓ bd-task-003 \"Create models\" (15m ago)\n\nOUTPUTS (recent):\n  select-task.work_bead = \"bd-task-005\"\n  setup-worktree.path = \".meow/worktrees/worker\"\n\nHEALTH:\n  Orchestrator: running (heartbeat 5s ago)\n  Lock: held by PID 12345\n```\n\n## Acceptance Criteria\n- [ ] Shows agent status\n- [ ] Shows bead counts and states\n- [ ] Shows currently executing beads\n- [ ] Shows recent outputs\n- [ ] --json produces parseable output\n- [ ] --watch updates live\n","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["cli","status"]}
{"id":"meow-e10.6","title":"Implement debug commands","description":"agents, beads, trace, peek, clean commands.","notes":"## Commands\n- `meow agents [--active]` - List agents and states\n- `meow beads [--ready] [--include-ephemeral]` - List beads\n- `meow trace [--follow]` - Show execution trace\n- `meow peek \u003cagent\u003e` - Show agent's current output\n- `meow attach \u003cagent\u003e` - Attach to tmux session\n- `meow clean --ephemeral` - Clean up ephemeral beads\n\n## --include-ephemeral Flag\nBy default, beads with `meow:ephemeral` label are hidden.\nThis keeps focus on work beads, not workflow machinery.\n\n## Acceptance Criteria\n- [ ] All debug commands work\n- [ ] Ephemeral beads hidden by default\n- [ ] --include-ephemeral shows all beads\n- [ ] meow clean --ephemeral removes closed ephemeral beads\n","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["cli","debug"]}
{"id":"meow-e11","title":"Comprehensive Testing: Unit, Integration, and E2E","description":"Comprehensive test coverage including unit tests, integration tests, and\nend-to-end tests with mock Claude. This epic is CRITICAL for reliability.\n","notes":"## Why This Epic is Non-Negotiable\nMEOW orchestrates long-running AI workflows. Bugs can waste hours of compute\nand cause data loss. We need:\n- Unit tests for every component\n- Integration tests for component interactions\n- E2E tests simulating real workflows\n- Detailed logging for debugging test failures\n\n## Phased Testing Strategy\nTesting is NOT a Phase 4 afterthought. Tests are written alongside code:\n\n| Test Type | Phase | Dependencies |\n|-----------|-------|--------------|\n| Test infrastructure (e11.1) | Phase 2 | E1 (types) |\n| Unit tests (e11.2-e11.5) | Phase 2 | Respective components |\n| Integration tests (e11.6) | Phase 3 | Core primitives |\n| E2E tests (e11.7) | Phase 4 | CLI + full system |\n| Performance (e11.8) | Phase 4 | Full system |\n\n## Test Categories\n1. **Unit Tests**: Individual functions and types (write with component)\n2. **Integration Tests**: Component interactions (write after primitives)\n3. **E2E Tests**: Full workflow execution with mock Claude (write after CLI)\n4. **Stress Tests**: Performance under load (final phase)\n\n## Coverage Requirements\n- Minimum 80% line coverage\n- 100% coverage for critical paths (output validation, bead transitions)\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-07T03:12:48.457391798-05:00","updated_at":"2026-01-07T03:12:48.457391798-05:00","labels":["critical","epic","testing"]}
{"id":"meow-e11.1","title":"Create test infrastructure and fixtures","description":"Set up testing infrastructure, fixtures, and helpers.","notes":"## Test Infrastructure\n\n### Directory Structure\n```\ninternal/testutil/\n├── fixtures.go      # Test data factories\n├── mock_tmux.go     # Mock tmux for agent tests\n├── mock_claude.go   # Mock Claude responses\n├── assertions.go    # Custom assertions\n├── logger.go        # Test logger that captures output\n└── cleanup.go       # Test cleanup helpers\n```\n\n### Test Fixtures\n```go\n// Create test beads\nfunc NewTestBead(t *testing.T, beadType string) *types.Bead\nfunc NewTestTemplate(t *testing.T, name string) *template.Template\nfunc NewTestConfig(t *testing.T) *config.Config\n\n// Create temp directories\nfunc NewTestWorkspace(t *testing.T) (path string, cleanup func())\n\n// Mock tmux\nfunc NewMockTmux(t *testing.T) *MockTmux\n```\n\n### Mock Claude\nScript that simulates Claude Code behavior:\n```bash\n#!/bin/bash\n# mock_claude.sh - Simulates Claude Code for testing\n# Reads meow prime, executes predefined responses, runs meow close\n\ncase \"$1\" in\n  --dangerously-skip-permissions)\n    # Enter mock REPL\n    while read -r line; do\n      if [[ \"$line\" == \"meow prime\" ]]; then\n        # Simulate Claude reading task and closing\n        BEAD_ID=$(meow prime --format json | jq -r .bead_id)\n        sleep 0.1\n        meow close \"$BEAD_ID\" --notes \"Mock completed\"\n      fi\n    done\n    ;;\nesac\n```\n\n### Test Logger\n```go\n// Captures structured logs for assertion\ntype TestLogger struct {\n    Entries []LogEntry\n}\n\nfunc (l *TestLogger) AssertContains(t *testing.T, msg string)\nfunc (l *TestLogger) AssertLevel(t *testing.T, level string, count int)\n```\n\n## Acceptance Criteria\n- [ ] Test fixtures create valid test data\n- [ ] Mock tmux simulates session lifecycle\n- [ ] Mock Claude script runs and responds\n- [ ] Test logger captures structured output\n- [ ] Cleanup removes all temp files\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["infrastructure","phase-2","testing"],"dependencies":[{"issue_id":"meow-e11.1","depends_on_id":"meow-e1.2","type":"blocks","created_at":"2026-01-07T03:14:35.647890862-05:00","created_by":"ubuntu"}]}
{"id":"meow-e11.10","title":"Create example workflows","description":"Complete example projects demonstrating MEOW capabilities.","notes":"## Example Projects\n```\nexamples/\n├── hello-world/           # Simplest possible workflow\n├── tdd-implementation/    # TDD with implement template\n├── multi-agent/           # Parent/child with call template\n├── human-approval/        # Human gate workflow\n└── context-aware/         # Context checking and refresh\n```\n\n## Each Example Includes\n- README with explanation\n- Complete template files\n- Expected output/trace\n- Troubleshooting tips\n\n## Acceptance Criteria\n- [ ] Each example runs standalone\n- [ ] Examples tested in CI\n- [ ] README explains what happens\n","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["docs","examples"]}
{"id":"meow-e11.2","title":"Unit tests for core types","description":"Unit tests for Bead, Agent, Config, and Template types.","notes":"## Test Files\n- internal/types/bead_test.go\n- internal/types/agent_test.go\n- internal/config/config_test.go\n- internal/template/template_test.go\n\n## Test Cases\n\n### Bead Tests\n- [ ] JSON marshaling/unmarshaling round-trip\n- [ ] Status transitions (open → in_progress → closed)\n- [ ] Invalid status transition errors\n- [ ] Output storage and retrieval\n- [ ] Ephemeral label detection\n- [ ] Dependency parsing\n\n### Agent Tests\n- [ ] State transitions (active → stopped)\n- [ ] Session ID storage\n- [ ] Environment variable generation\n\n### Config Tests\n- [ ] Default values applied\n- [ ] File override works\n- [ ] Unknown fields ignored\n- [ ] Invalid values error with context\n\n### Template Tests\n- [ ] TOML parsing\n- [ ] Variable definition parsing\n- [ ] Step dependency parsing\n- [ ] Output spec parsing\n\n## Acceptance Criteria\n- [ ] All types have \u003e90% coverage\n- [ ] Edge cases covered (empty, nil, max values)\n- [ ] Error messages tested\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["phase-2","testing","unit"],"dependencies":[{"issue_id":"meow-e11.2","depends_on_id":"meow-e11.1","type":"blocks","created_at":"2026-01-07T03:14:35.733868852-05:00","created_by":"ubuntu"},{"issue_id":"meow-e11.2","depends_on_id":"meow-e1.2","type":"blocks","created_at":"2026-01-07T03:14:35.823298363-05:00","created_by":"ubuntu"}]}
{"id":"meow-e11.3","title":"Unit tests for template system","description":"Unit tests for template parsing, validation, and baking.","notes":"## Test Files\n- internal/template/parser_test.go\n- internal/template/validator_test.go\n- internal/template/variables_test.go\n- internal/template/baker_test.go\n\n## Test Cases\n\n### Parser Tests\n- [ ] Valid template parses correctly\n- [ ] Invalid TOML returns parse error with line number\n- [ ] All step types parsed correctly\n- [ ] Inline expansion targets parsed\n- [ ] Template expansion targets parsed\n- [ ] Output specs parsed\n\n### Validator Tests\n- [ ] Missing meta.name errors\n- [ ] Duplicate step IDs error\n- [ ] Invalid step type errors\n- [ ] Circular dependencies detected\n- [ ] Missing needs references detected\n- [ ] Undefined variable references detected\n- [ ] Type mismatches detected\n\n### Variable Substitution Tests\n- [ ] Basic {{var}} substitution\n- [ ] Nested {{a.b.c}} access\n- [ ] Output reference {{bead.outputs.field}}\n- [ ] Built-in variables ({{agent}}, {{timestamp}})\n- [ ] Missing required variable errors\n- [ ] Default values applied\n- [ ] Recursive substitution detected and errors\n\n### Baker Tests\n- [ ] Simple template bakes to correct beads\n- [ ] Dependencies translated to bead IDs\n- [ ] Inline steps become child beads\n- [ ] Ephemeral flag propagates\n- [ ] Output references preserved for runtime\n\n## Acceptance Criteria\n- [ ] Template system has \u003e90% coverage\n- [ ] All error paths tested\n- [ ] Performance: 1000 templates parse in \u003c1s\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["phase-2","testing","unit"],"dependencies":[{"issue_id":"meow-e11.3","depends_on_id":"meow-e11.1","type":"blocks","created_at":"2026-01-07T03:14:35.910711208-05:00","created_by":"ubuntu"},{"issue_id":"meow-e11.3","depends_on_id":"meow-e2","type":"blocks","created_at":"2026-01-07T03:14:35.999393122-05:00","created_by":"ubuntu"}]}
{"id":"meow-e11.4","title":"Unit tests for primitive handlers","description":"Unit tests for all 6 primitive handlers.","notes":"## Test Files\n- internal/primitive/task_test.go\n- internal/primitive/condition_test.go\n- internal/primitive/code_test.go\n- internal/primitive/expand_test.go\n- internal/primitive/start_test.go\n- internal/primitive/stop_test.go\n\n## Test Cases\n\n### Task Handler Tests\n- [ ] Waits for bead to close\n- [ ] Validates required outputs\n- [ ] Rejects invalid output types\n- [ ] Stores validated outputs\n- [ ] Handles agent death\n\n### Condition Handler Tests\n- [ ] Exit 0 expands on_true\n- [ ] Exit non-0 expands on_false\n- [ ] Timeout expands on_timeout\n- [ ] Runs in goroutine (non-blocking)\n- [ ] Cancellation works\n\n### Code Handler Tests\n- [ ] Executes shell command\n- [ ] Captures stdout to output\n- [ ] Captures stderr to output\n- [ ] Reads file to output\n- [ ] Handles on_error: continue\n- [ ] Handles on_error: abort\n- [ ] Handles on_error: retry\n\n### Expand Handler Tests\n- [ ] Loads template\n- [ ] Substitutes variables\n- [ ] Resolves output references\n- [ ] Creates child beads\n- [ ] Sets ephemeral labels\n- [ ] Wires dependencies\n\n### Start Handler Tests\n- [ ] Creates tmux session\n- [ ] Sets workdir from output reference\n- [ ] Fresh start works\n- [ ] Resume with session_id works\n- [ ] Injects meow prime\n\n### Stop Handler Tests\n- [ ] Graceful stop sends interrupt\n- [ ] Force kill after timeout\n- [ ] Works if session doesn't exist\n- [ ] Updates agent state\n\n## Acceptance Criteria\n- [ ] Each handler has \u003e90% coverage\n- [ ] All error conditions tested\n- [ ] Mock tmux used (no real sessions)\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["phase-2","testing","unit"],"dependencies":[{"issue_id":"meow-e11.4","depends_on_id":"meow-e11.1","type":"blocks","created_at":"2026-01-07T03:14:36.089044935-05:00","created_by":"ubuntu"},{"issue_id":"meow-e11.4","depends_on_id":"meow-e4","type":"blocks","created_at":"2026-01-07T03:14:36.178016699-05:00","created_by":"ubuntu"}]}
{"id":"meow-e11.5","title":"Unit tests for output binding","description":"Unit tests for output capture, storage, and resolution.","notes":"## Test Files\n- internal/output/capture_test.go\n- internal/output/storage_test.go\n- internal/output/resolver_test.go\n- internal/output/validator_test.go\n\n## Test Cases\n\n### Output Capture Tests\n- [ ] Captures stdout (trimmed)\n- [ ] Captures stderr (trimmed)\n- [ ] Reads file contents\n- [ ] Handles missing file gracefully\n- [ ] Handles empty output\n\n### Output Storage Tests\n- [ ] Stores outputs on bead\n- [ ] Persists across save/load\n- [ ] Visible in bd show\n\n### Output Resolver Tests\n- [ ] Resolves {{bead.outputs.field}}\n- [ ] Errors on non-existent bead\n- [ ] Errors on unclosed bead\n- [ ] Errors on missing field\n- [ ] Suggests similar beads on typo\n\n### Output Validator Tests\n- [ ] string type validation\n- [ ] number type validation\n- [ ] boolean type validation\n- [ ] bead_id type validation (checks existence)\n- [ ] file_path type validation (checks existence)\n- [ ] string[] type validation\n- [ ] json type validation\n- [ ] Error messages include expected type\n\n## Acceptance Criteria\n- [ ] All output types have validation tests\n- [ ] Error messages are helpful\n- [ ] Edge cases covered (empty, null, unicode)\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["outputs","phase-2","testing","unit"],"dependencies":[{"issue_id":"meow-e11.5","depends_on_id":"meow-e11.1","type":"blocks","created_at":"2026-01-07T03:14:36.269736743-05:00","created_by":"ubuntu"},{"issue_id":"meow-e11.5","depends_on_id":"meow-e7","type":"blocks","created_at":"2026-01-07T03:14:36.359893174-05:00","created_by":"ubuntu"}]}
{"id":"meow-e11.6","title":"Integration tests for orchestrator","description":"Integration tests for orchestrator main loop and state management.","notes":"## Test Files\n- internal/orchestrator/integration_test.go\n\n## Test Scenarios\n\n### Basic Execution\n- [ ] Simple linear workflow (3 code beads)\n- [ ] Workflow with dependencies (diamond pattern)\n- [ ] Workflow completes when all beads closed\n\n### State Management\n- [ ] State persists across loop iterations\n- [ ] Crash recovery resumes from last state\n- [ ] Lock prevents concurrent orchestrators\n- [ ] Heartbeat updates regularly\n\n### Bead Transitions\n- [ ] open → in_progress → closed\n- [ ] Dependency blocking works\n- [ ] Ready detection is correct\n\n### Logging\n- [ ] All dispatch actions logged\n- [ ] Log includes bead_id, agent, type\n- [ ] Errors logged with context\n\n## Test Setup\n```go\nfunc TestOrchestrator_LinearWorkflow(t *testing.T) {\n    workspace := testutil.NewTestWorkspace(t)\n    defer workspace.Cleanup()\n\n    // Create test beads\n    beads := []types.Bead{\n        testutil.NewCodeBead(\"step1\", \"echo hello\"),\n        testutil.NewCodeBead(\"step2\", \"echo world\", \"step1\"),\n        testutil.NewCodeBead(\"step3\", \"echo done\", \"step2\"),\n    }\n\n    // Run orchestrator\n    orch := orchestrator.New(testutil.NewTestConfig(t))\n    err := orch.Run(context.Background(), beads)\n\n    require.NoError(t, err)\n    // Assert all beads closed\n}\n```\n\n## Acceptance Criteria\n- [ ] All scenarios pass\n- [ ] No real tmux sessions created\n- [ ] Tests run in \u003c5s\n- [ ] Parallel test execution works\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["integration","phase-3","testing"],"dependencies":[{"issue_id":"meow-e11.6","depends_on_id":"meow-e11.2","type":"blocks","created_at":"2026-01-07T03:14:36.452558633-05:00","created_by":"ubuntu"},{"issue_id":"meow-e11.6","depends_on_id":"meow-e11.4","type":"blocks","created_at":"2026-01-07T03:14:36.547568478-05:00","created_by":"ubuntu"}]}
{"id":"meow-e11.7","title":"E2E tests with mock Claude","description":"End-to-end tests simulating real workflows with mock Claude.","notes":"## E2E Test Framework\n\n### Mock Claude Script\n```bash\n# test/mock_claude.sh\n#!/bin/bash\nset -e\n\nLOG_FILE=\"${MEOW_TEST_LOG:-/tmp/mock_claude.log}\"\n\nlog() {\n    echo \"[$(date -Iseconds)] $*\" \u003e\u003e \"$LOG_FILE\"\n}\n\nlog \"Mock Claude started with args: $*\"\n\n# Simulate Claude startup\nsleep 0.2\necho \"Claude Code ready\"\n\n# Wait for prompts\nwhile IFS= read -r line; do\n    log \"Received: $line\"\n\n    if [[ \"$line\" == *\"meow prime\"* ]]; then\n        log \"Executing meow prime\"\n        PRIME_OUTPUT=$(meow prime --format json 2\u003e/dev/null || echo '{}')\n        BEAD_ID=$(echo \"$PRIME_OUTPUT\" | jq -r '.bead_id // empty')\n\n        if [[ -n \"$BEAD_ID\" ]]; then\n            log \"Found bead: $BEAD_ID\"\n\n            # Check for required outputs\n            OUTPUTS=$(echo \"$PRIME_OUTPUT\" | jq -r '.required_outputs // []')\n            OUTPUT_ARGS=\"\"\n\n            if [[ \"$OUTPUTS\" != \"[]\" ]]; then\n                # Generate mock outputs\n                for output in $(echo \"$OUTPUTS\" | jq -r '.[].name'); do\n                    OUTPUT_ARGS=\"$OUTPUT_ARGS --output $output=mock_value\"\n                done\n            fi\n\n            # Close the bead\n            log \"Closing bead: meow close $BEAD_ID $OUTPUT_ARGS\"\n            meow close \"$BEAD_ID\" --notes \"Mock completed\" $OUTPUT_ARGS\n        fi\n    fi\ndone\n```\n\n### E2E Test Scenarios\n```\ntest/e2e/\n├── simple_workflow_test.go      # Linear code beads\n├── condition_branching_test.go  # on_true/on_false\n├── output_passing_test.go       # Code outputs to start\n├── task_outputs_test.go         # Claude provides outputs\n├── parent_child_test.go         # Call template\n├── crash_recovery_test.go       # Kill and resume\n├── human_gate_test.go           # meow approve flow\n└── ephemeral_cleanup_test.go    # Ephemeral bead cleanup\n```\n\n### Test Structure\n```go\nfunc TestE2E_ParentChildOrchestration(t *testing.T) {\n    if testing.Short() {\n        t.Skip(\"Skipping E2E test\")\n    }\n\n    workspace := testutil.NewTestWorkspace(t)\n    defer workspace.Cleanup()\n\n    // Setup mock Claude\n    mockClaude := testutil.NewMockClaude(t)\n    mockClaude.OnTask(\"select-task\", func(b *types.Bead) {\n        return map[string]string{\"work_bead\": \"bd-task-001\"}\n    })\n\n    // Run workflow\n    result := runE2EWorkflow(t, \"work-loop\", map[string]string{\n        \"agent\": \"claude-1\",\n    })\n\n    // Assertions\n    assert.True(t, result.Completed)\n    assert.Equal(t, 3, result.BeadsExecuted)\n    assertLogContains(t, \"Resuming parent\")\n}\n```\n\n## Acceptance Criteria - Infrastructure\n- [ ] Mock Claude script works reliably\n- [ ] Test fixtures create valid test data\n- [ ] Tests complete in \u003c30s each\n- [ ] Detailed logging for debugging failures\n- [ ] No real Claude API calls\n- [ ] Cleanup removes all temp files/sessions\n\n## Acceptance Criteria - Core Scenarios\nEach of these scenarios must pass:\n\n### Simple Workflow (simple_workflow_test.go)\n- [ ] Linear code beads execute in order\n- [ ] Dependencies are respected\n\n### Condition Branching (condition_branching_test.go)\n- [ ] on_true path works\n- [ ] on_false path works\n- [ ] Nested conditions work\n\n### Output Binding (output_passing_test.go)\n- [ ] Code bead captures stdout to output\n- [ ] Start bead uses output reference for workdir\n- [ ] Output values flow correctly between beads\n\n### Task Output Validation (task_outputs_test.go)\n- [ ] Missing required outputs are rejected\n- [ ] Invalid bead_id outputs are rejected with helpful error\n- [ ] Valid outputs are stored and accessible\n- [ ] Subsequent beads can read outputs via {{bead.outputs.field}}\n\n### Parent/Child Orchestration (parent_child_test.go)\n- [ ] call template spawns child correctly\n- [ ] Parent session is saved\n- [ ] Child completes work\n- [ ] Parent resumes with context\n\n### Crash Recovery (crash_recovery_test.go)\n- [ ] Kill orchestrator mid-workflow\n- [ ] State is persisted to disk\n- [ ] Restart resumes from last state\n- [ ] In-progress beads from dead agents reset\n- [ ] No duplicate work done\n\n### Human Gate (human_gate_test.go)\n- [ ] Blocking condition waits for approval\n- [ ] meow approve unblocks correctly\n- [ ] meow reject triggers on_false path\n\n### Ephemeral Cleanup (ephemeral_cleanup_test.go)\n- [ ] Ephemeral beads get correct label\n- [ ] meow clean --ephemeral removes closed ephemeral beads\n- [ ] Non-ephemeral beads are preserved\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["critical","e2e","testing"],"dependencies":[{"issue_id":"meow-e11.7","depends_on_id":"meow-e11.6","type":"blocks","created_at":"2026-01-07T03:14:36.639894591-05:00","created_by":"ubuntu"}]}
{"id":"meow-e11.8","title":"Stress tests and performance benchmarks","description":"Performance tests and benchmarks for critical paths.","notes":"## Benchmark Tests\n```\ninternal/benchmark/\n├── template_parse_bench_test.go\n├── bead_dispatch_bench_test.go\n├── output_resolution_bench_test.go\n└── state_persistence_bench_test.go\n```\n\n## Performance Requirements\n| Operation | Target | Max |\n|-----------|--------|-----|\n| Template parse | \u003c1ms | 5ms |\n| Variable substitution | \u003c100µs | 500µs |\n| Bead dispatch | \u003c10ms | 50ms |\n| State save | \u003c50ms | 200ms |\n| Output resolution | \u003c1ms | 5ms |\n\n## Stress Tests\n- [ ] 1000 beads in single workflow\n- [ ] 100 concurrent output references\n- [ ] 50 nested template expansions\n- [ ] Rapid bead state transitions\n\n## Memory Profiling\n- [ ] No memory leaks in long-running workflows\n- [ ] Memory usage stable over 1000 iterations\n\n## Acceptance Criteria\n- [ ] All benchmarks meet targets\n- [ ] No degradation over time\n- [ ] Results logged for CI tracking\n","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["performance","testing"],"dependencies":[{"issue_id":"meow-e11.8","depends_on_id":"meow-e11.6","type":"blocks","created_at":"2026-01-07T03:14:36.732282858-05:00","created_by":"ubuntu"}]}
{"id":"meow-e11.9","title":"Write user documentation","description":"Comprehensive user documentation for MEOW Stack.","notes":"## Documentation Structure\n```\ndocs/\n├── getting-started.md      # Quick start guide\n├── concepts.md             # Core concepts (primitives, templates, outputs)\n├── template-authoring.md   # How to write templates\n├── cli-reference.md        # All CLI commands\n├── output-binding.md       # Output capture and references\n├── troubleshooting.md      # Common issues and solutions\n└── examples/\n    ├── simple-workflow.md\n    ├── parent-child.md\n    └── human-gate.md\n```\n\n## Content Requirements\n- All 6 primitives documented with examples\n- Output binding explained with diagrams\n- Task outputs and validation explained\n- Ephemeral beads explained\n- Error codes and recovery\n\n## Acceptance Criteria\n- [ ] Getting started takes \u003c10 min\n- [ ] All CLI commands documented\n- [ ] Examples are copy-paste runnable\n- [ ] Troubleshooting covers common errors\n","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["docs"]}
{"id":"meow-e2","title":"Template System: Parser, variables, and baking","description":"Parse TOML templates, substitute variables, validate structure, and \"bake\"\ntemplates into beads.\n","notes":"## Why This Epic Matters\n\nTemplates are the \"programs\" in MEOW. They define workflows using the 6\nprimitives. This epic makes templates usable.\n\n## Key Components\n1. TOML parser with template-specific handling\n2. Variable substitution engine (including output references)\n3. Template validation\n4. Baking (template → beads)\n5. Output reference resolution ({{bead.outputs.field}})\n6. Ephemeral flag handling\n\n## Success Criteria\n- Can parse any valid MEOW template\n- Variable substitution works with nesting\n- Output references ({{bead.outputs.field}}) resolve correctly\n- Ephemeral templates get proper labeling\n- Validation catches common errors\n- Baking creates correct beads with dependencies\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-07T03:12:48.457391798-05:00","updated_at":"2026-01-07T03:12:48.457391798-05:00","labels":["epic","phase-1","templates"],"dependencies":[{"issue_id":"meow-e2","depends_on_id":"meow-e1","type":"blocks","created_at":"2026-01-07T03:14:30.411886337-05:00","created_by":"ubuntu"}]}
{"id":"meow-e2.1","title":"Implement TOML template parser","description":"Parse MEOW template files from TOML format.","notes":"## Template Structure\n- [meta] section: name, version, description, etc.\n- [variables] section: variable definitions with types/defaults\n- [[steps]] array: workflow steps\n\n## Go Types\n- Template struct\n- TemplateMeta struct\n- VariableDef struct\n- TemplateStep struct\n- ExpansionTarget struct (for on_true/on_false)\n\n## Acceptance Criteria\n- [ ] Parse valid template without error\n- [ ] Return helpful error for invalid TOML\n- [ ] Handle all step types correctly\n- [ ] Support inline and template expansion targets\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["parser","templates"],"dependencies":[{"issue_id":"meow-e2.1","depends_on_id":"meow-e1.2","type":"blocks","created_at":"2026-01-07T03:14:30.502169754-05:00","created_by":"ubuntu"}]}
{"id":"meow-e2.2","title":"Implement variable substitution engine","description":"Implement {{variable}} substitution throughout templates.","notes":"## Substitution Types\n- Basic: {{task_id}} → value\n- Nested: {{output.step.field}} → nested value\n- **Output references: {{bead_id.outputs.field}} → captured output**\n- Builtins: {{agent}}, {{bead_id}}, {{timestamp}}, etc.\n\n## Output Reference Resolution\nWhen a template references {{some_bead.outputs.field}}:\n1. Find bead with matching ID in same workflow\n2. Look up outputs.field from bead's stored outputs\n3. Substitute the value\n\nThis enables dynamic data flow:\n- code bead captures stdout → subsequent bead uses it\n- task bead validates output → expand bead uses it\n\n## Edge Cases\n- Unset required variable → error\n- Unset optional with default → use default\n- Recursive substitution → detect and error\n- Missing output reference → error with helpful message\n\n## Acceptance Criteria\n- [ ] Basic {{var}} substitution works\n- [ ] Nested {{a.b.c}} access works\n- [ ] **Output references {{bead.outputs.field}} resolve correctly**\n- [ ] Built-in variables populated\n- [ ] Missing required variable errors clearly\n- [ ] Missing output reference errors with bead context\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["templates","variables"],"dependencies":[{"issue_id":"meow-e2.2","depends_on_id":"meow-e2.1","type":"blocks","created_at":"2026-01-07T03:14:30.591582666-05:00","created_by":"ubuntu"}]}
{"id":"meow-e2.3","title":"Implement template validation","description":"Validate templates for correctness before baking.","notes":"## Validations\n- Structure: meta.name required, unique step IDs, valid types\n- Dependencies: needs references exist, no cycles, all reachable\n- Variables: all {{var}} references defined\n- Type-specific: condition has on_true/on_false, expand has template, etc.\n\n## Error Messages\nShould include:\n- Template name and step ID\n- What's wrong\n- Suggestions (\"did you mean X?\")\n\n## Acceptance Criteria\n- [ ] Catches missing required fields\n- [ ] Detects circular dependencies\n- [ ] Suggests corrections for typos\n- [ ] Returns all errors, not just first\n","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["templates","validation"],"dependencies":[{"issue_id":"meow-e2.3","depends_on_id":"meow-e2.1","type":"blocks","created_at":"2026-01-07T03:14:30.678684394-05:00","created_by":"ubuntu"}]}
{"id":"meow-e2.4","title":"Implement template baking (template → beads)","description":"Transform a parsed, validated template into executable beads.","notes":"## Baking Process\n1. Load template\n2. Validate\n3. Substitute variables\n4. Generate bead IDs for each step\n5. Translate needs from step IDs to bead IDs\n6. Create beads\n\n## ID Generation\nFormat: {workflow_id}.{step_id}-{hash}\nExample: meow-run-001.load-context-a3f8\n\n## Handling Nested Structures\n- expand steps create placeholder beads (runtime expansion)\n- inline steps in conditions get baked immediately\n\n## Acceptance Criteria\n- [ ] Simple template bakes to correct beads\n- [ ] Dependencies translate correctly\n- [ ] Inline steps become child beads\n- [ ] Bead IDs are unique and traceable\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["baking","templates"],"dependencies":[{"issue_id":"meow-e2.4","depends_on_id":"meow-e2.2","type":"blocks","created_at":"2026-01-07T03:14:30.78982717-05:00","created_by":"ubuntu"},{"issue_id":"meow-e2.4","depends_on_id":"meow-e2.3","type":"blocks","created_at":"2026-01-07T03:14:30.882377165-05:00","created_by":"ubuntu"}]}
{"id":"meow-e2.5","title":"Implement template loading from filesystem and embedded","description":"Load templates from multiple sources with precedence.","notes":"## Load Order\n1. Project: .meow/templates/{name}.toml\n2. User: ~/.config/meow/templates/{name}.toml\n3. Embedded: Built into binary\n\n## Embedded Templates\nUse Go embed directive:\n```go\n//go:embed templates/*.toml\nvar embeddedTemplates embed.FS\n```\n\n## Acceptance Criteria\n- [ ] Embedded templates load correctly\n- [ ] Project templates override embedded\n- [ ] Helpful error when template not found\n","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["loading","templates"],"dependencies":[{"issue_id":"meow-e2.5","depends_on_id":"meow-e2.1","type":"blocks","created_at":"2026-01-07T03:14:30.970749274-05:00","created_by":"ubuntu"}]}
{"id":"meow-e3","title":"Orchestrator Core: Main loop and state management","description":"The heart of MEOW. Main loop, bead readiness detection, state management,\nand recovery.\n","notes":"## Design Philosophy\n\u003e \"The orchestrator is dumb; the templates are smart.\"\n\nThe orchestrator knows ONLY the 6 primitives. Everything else—loops,\ngates, refresh, checkpoint/resume—is template composition.\n\n## Success Criteria\n- Main loop runs continuously\n- Correctly identifies ready beads\n- Dispatches to appropriate handlers (6 types)\n- Captures and stores outputs from code beads\n- Validates and stores outputs from task beads\n- Persists state for recovery\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-07T03:12:48.457391798-05:00","updated_at":"2026-01-07T03:12:48.457391798-05:00","labels":["epic","orchestrator","phase-1"],"dependencies":[{"issue_id":"meow-e3","depends_on_id":"meow-e1","type":"blocks","created_at":"2026-01-07T03:14:31.059165616-05:00","created_by":"ubuntu"},{"issue_id":"meow-e3","depends_on_id":"meow-e2","type":"blocks","created_at":"2026-01-07T03:14:31.149251566-05:00","created_by":"ubuntu"}]}
{"id":"meow-e3.1","title":"Implement orchestrator main loop","description":"Implement the core orchestrator loop.","notes":"## Loop Structure\n```go\nfor {\n    bead := getNextReadyBead()\n    if bead == nil {\n        if allDone() { return nil }\n        sleep and continue\n    }\n    dispatch(bead)\n    updateHeartbeat()\n}\n```\n\n## Dispatch by Type (6 primitives)\n```go\nswitch bead.Type {\ncase \"task\":      waitForClaudeToClose(bead)\ncase \"condition\": evalAndExpand(bead)  // may block!\ncase \"stop\":      killAgent(bead)\ncase \"start\":     spawnAgent(bead)  // handles resume_session\ncase \"code\":      execShell(bead)   // captures outputs\ncase \"expand\":    expandTemplate(bead)\n}\n```\n\n## Concurrency\nConditions run in goroutines to avoid blocking main loop.\n\n## Acceptance Criteria\n- [ ] Loop runs until no ready beads\n- [ ] Dispatches correctly to all 6 handlers\n- [ ] Conditions don't block main loop\n- [ ] Graceful shutdown on context cancel\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["main-loop","orchestrator"],"dependencies":[{"issue_id":"meow-e3.1","depends_on_id":"meow-e1.2","type":"blocks","created_at":"2026-01-07T03:14:31.236169907-05:00","created_by":"ubuntu"}]}
{"id":"meow-e3.2","title":"Implement bead readiness detection","description":"Determine which beads are ready for execution.","notes":"## Readiness Rules\nA bead is ready when:\n1. Status is `open`\n2. All beads in `needs` are `closed`\n3. Not already being processed\n\n## Priority Ordering\n1. Orchestrator beads first (condition, expand, code, stop, etc.)\n2. Then task beads\n3. Within type: earlier creation time\n\n## Change Detection\nWatch .beads/issues.jsonl for changes rather than polling.\n\n## Acceptance Criteria\n- [ ] Correctly identifies ready beads\n- [ ] Dependencies checked correctly\n- [ ] Priority ordering correct\n- [ ] File watching triggers re-check\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["orchestrator","readiness"],"dependencies":[{"issue_id":"meow-e3.2","depends_on_id":"meow-e3.1","type":"blocks","created_at":"2026-01-07T03:14:31.32470772-05:00","created_by":"ubuntu"}]}
{"id":"meow-e3.3","title":"Implement orchestrator state persistence","description":"Persist orchestrator state for crash recovery.","notes":"## State Files\n- .meow/state/orchestrator.json - workflow state\n- .meow/agents.json - agent states\n- .meow/state/heartbeat.json - health check\n- .meow/state/orchestrator.lock - prevent concurrent\n\n## Atomic Writes\nWrite to temp file, then rename.\n\n## Lock File\nPrevent concurrent orchestrators via exclusive lock.\n\n## Acceptance Criteria\n- [ ] State persists across iterations\n- [ ] Atomic writes prevent corruption\n- [ ] Lock prevents concurrent instances\n- [ ] Stale lock detection works\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["orchestrator","state"],"dependencies":[{"issue_id":"meow-e3.3","depends_on_id":"meow-e3.1","type":"blocks","created_at":"2026-01-07T03:14:31.416863508-05:00","created_by":"ubuntu"}]}
{"id":"meow-e3.4","title":"Implement orchestrator startup and crash recovery","description":"Handle orchestrator startup, including recovery from crashes.","notes":"## Startup Flow\n1. Acquire lock\n2. Check for existing state\n3. If exists: resume flow\n4. If not: fresh start flow\n\n## Recovery Flow\n1. Load orchestrator state\n2. Load agent states\n3. Reconcile with reality (check tmux sessions)\n4. Reset in-progress beads from dead agents\n5. Resume main loop\n\n## Acceptance Criteria\n- [ ] Fresh start creates beads and spawns agent\n- [ ] Resume loads existing state\n- [ ] Dead agents detected via tmux\n- [ ] In-progress beads from dead agents reset\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["orchestrator","recovery"],"dependencies":[{"issue_id":"meow-e3.4","depends_on_id":"meow-e3.3","type":"blocks","created_at":"2026-01-07T03:14:31.504407164-05:00","created_by":"ubuntu"}]}
{"id":"meow-e3.5","title":"Implement execution trace logging","description":"Log all orchestrator actions for debugging and audit.","notes":"## Trace Format\nJSONL in .meow/state/trace.jsonl\nEach entry: timestamp, action, details\n\n## Actions to Log\n- start, bake, spawn, dispatch, condition_eval, expand, close\n\n## CLI Access\n`meow trace [--follow] [--json] [--since 1h]`\n\n## Acceptance Criteria\n- [ ] All dispatch actions logged\n- [ ] Trace survives crash\n- [ ] meow trace command works\n","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["logging","orchestrator"],"dependencies":[{"issue_id":"meow-e3.5","depends_on_id":"meow-e3.1","type":"blocks","created_at":"2026-01-07T03:14:31.594932116-05:00","created_by":"ubuntu"}]}
{"id":"meow-e3.6","title":"Implement graceful orchestrator shutdown","description":"Handle SIGTERM/SIGINT gracefully to prevent state corruption.","notes":"## Why This Task\nOrchestrator can be killed (Ctrl+C, systemd stop, etc.). Without graceful\nshutdown, we risk:\n- Corrupted state files (mid-write)\n- Orphaned tmux sessions\n- In-progress beads stuck forever\n\n## Shutdown Flow\n1. Receive SIGTERM or SIGINT\n2. Cancel main loop context\n3. Save orchestrator state immediately\n4. For each active agent:\n   - Send graceful stop (Ctrl+C to tmux)\n   - Wait up to grace_period (configurable, default 10s)\n   - Force kill if still running\n5. Update agent states to \"stopped\"\n6. Release lock file\n7. Exit cleanly\n\n## Implementation\n```go\nfunc (o *Orchestrator) setupSignalHandling(ctx context.Context) context.Context {\n    ctx, cancel := context.WithCancel(ctx)\n\n    sigChan := make(chan os.Signal, 1)\n    signal.Notify(sigChan, syscall.SIGTERM, syscall.SIGINT)\n\n    go func() {\n        sig := \u003c-sigChan\n        o.logger.Info(\"Received signal, shutting down gracefully\",\n            \"signal\", sig)\n\n        // Save state first\n        if err := o.saveState(); err != nil {\n            o.logger.Error(\"Failed to save state during shutdown\", \"error\", err)\n        }\n\n        // Stop all agents\n        for _, agent := range o.agentStore.ListByStatus(AgentActive) {\n            o.stopAgentGracefully(agent, o.cfg.StopGracePeriod)\n        }\n\n        // Release lock\n        o.lock.Release()\n\n        cancel()\n    }()\n\n    return ctx\n}\n```\n\n## Config\n```toml\n[orchestrator]\nstop_grace_period = 10  # seconds to wait for agent cleanup\n```\n\n## Acceptance Criteria\n- [ ] SIGTERM triggers graceful shutdown\n- [ ] SIGINT (Ctrl+C) triggers graceful shutdown\n- [ ] State is saved before agent cleanup\n- [ ] Active agents receive stop signal\n- [ ] Lock file is released\n- [ ] Exit code is 0 for clean shutdown\n- [ ] Integration test: kill -TERM during execution\n","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["orchestrator","reliability","shutdown"],"dependencies":[{"issue_id":"meow-e3.6","depends_on_id":"meow-e3.4","type":"blocks","created_at":"2026-01-07T03:14:31.684651471-05:00","created_by":"ubuntu"},{"issue_id":"meow-e3.6","depends_on_id":"meow-e5.3","type":"blocks","created_at":"2026-01-07T03:14:31.770870614-05:00","created_by":"ubuntu"}]}
{"id":"meow-e4","title":"Primitive Handlers: All 6 primitive implementations","description":"Implement the handlers for all 6 primitive bead types.\n","notes":"## The 6 Primitives\n1. task - Wait for Claude to close (with output validation)\n2. condition - Evaluate shell, expand on_true/on_false\n3. stop - Kill tmux session\n4. start - Spawn tmux session (with optional resume_session)\n5. code - Execute shell script (with output capture)\n6. expand - Load and bake template (with ephemeral support)\n\n## Why 6 Instead of 8?\ncheckpoint and resume are now composed from code + start:\n- checkpoint → code bead with `meow session-id`\n- resume → start bead with `resume_session` parameter\n\n## Success Criteria\n- All 6 primitives have working handlers\n- Code beads capture and store outputs\n- Task beads validate required outputs\n- Start beads handle resume_session\n- Handlers are isolated and testable\n- Error handling is consistent\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-07T03:12:48.457391798-05:00","updated_at":"2026-01-07T03:12:48.457391798-05:00","labels":["epic","phase-2","primitives"],"dependencies":[{"issue_id":"meow-e4","depends_on_id":"meow-e3","type":"blocks","created_at":"2026-01-07T03:14:31.85942527-05:00","created_by":"ubuntu"}]}
{"id":"meow-e4.1","title":"Implement task primitive handler","description":"Handle task beads by waiting for Claude to close them with validated outputs.","notes":"## Behavior\n1. Verify assigned agent is running\n2. Mark bead in_progress\n3. Wait for bead status to become closed\n4. **Validate outputs if task has required outputs**\n5. Store validated outputs on bead\n6. Return (main loop finds next bead)\n\n## Task Outputs\nTasks can declare required/optional outputs:\n```yaml\noutputs:\n  required:\n    - name: \"work_bead\"\n      type: \"bead_id\"\n  optional:\n    - name: \"notes\"\n      type: \"string\"\n```\n\nClaude closes with: `meow close \u003cbead\u003e --output work_bead=bd-123`\n\n## Output Types\n- string, string[], number, boolean, json\n- bead_id (validated against .beads/)\n- file_path (validated file exists)\n\n## Agent runs `meow close` when done\n\n## Acceptance Criteria\n- [ ] Waits for agent to close bead\n- [ ] Marks bead in_progress\n- [ ] **Validates required outputs before accepting close**\n- [ ] **Stores outputs on bead for subsequent references**\n- [ ] Returns validation errors if outputs missing/invalid\n- [ ] Returns when bead is closed with valid outputs\n- [ ] Handles agent death gracefully\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["primitives","task"],"dependencies":[{"issue_id":"meow-e4.1","depends_on_id":"meow-e3.2","type":"blocks","created_at":"2026-01-07T03:14:31.947185006-05:00","created_by":"ubuntu"}]}
{"id":"meow-e4.2","title":"Implement condition primitive handler","description":"Handle condition beads by evaluating shell and expanding results.","notes":"## Behavior\n1. Mark in_progress\n2. Execute shell command (in goroutine - may block!)\n3. Based on exit code, expand on_true or on_false\n4. Close bead\n\n## Key Insight\nConditions can block indefinitely - human gates, CI waits, etc.\n\n## Acceptance Criteria\n- [ ] Shell command executes\n- [ ] Exit 0 → on_true\n- [ ] Exit ≠0 → on_false\n- [ ] Timeout → on_timeout\n- [ ] Bead auto-closes\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["condition","primitives"],"dependencies":[{"issue_id":"meow-e4.2","depends_on_id":"meow-e3.2","type":"blocks","created_at":"2026-01-07T03:14:32.037137586-05:00","created_by":"ubuntu"}]}
{"id":"meow-e4.3","title":"Implement code primitive handler","description":"Handle code beads by executing shell scripts with output capture.","notes":"## Behavior\n1. Execute code in shell\n2. Capture stdout/stderr\n3. **If outputs defined: capture specified outputs**\n4. **Store outputs on bead for subsequent references**\n5. Handle errors based on on_error policy\n6. Close bead\n\n## Output Capture\n```yaml\noutputs:\n  path: stdout           # Capture stdout\n  error_log: stderr      # Capture stderr\n  sha: file:/tmp/sha.txt # Read from file\n  result: exit_code      # Exit code as string\n```\n\nOutputs become available as {{bead_id.outputs.field}}\n\n## Example: Worktree creation\n```yaml\ntype: code\ncode: |\n  git worktree add -b meow/worker ~/worktrees/worker HEAD\n  echo \"~/worktrees/worker\"\noutputs:\n  path: stdout\n```\n\nNext bead uses: `workdir = \"{{create-worktree.outputs.path}}\"`\n\n## on_error Options\n- continue: log and continue\n- abort: stop workflow\n- retry: retry up to max_retries\n\n## Acceptance Criteria\n- [ ] Shell script executes\n- [ ] Working directory set correctly\n- [ ] Environment variables passed\n- [ ] **stdout captured when outputs.X = stdout**\n- [ ] **File contents captured when outputs.X = file:/path**\n- [ ] **Outputs stored on bead for reference**\n- [ ] on_error policies work\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["code","primitives"],"dependencies":[{"issue_id":"meow-e4.3","depends_on_id":"meow-e3.2","type":"blocks","created_at":"2026-01-07T03:14:32.129174786-05:00","created_by":"ubuntu"}]}
{"id":"meow-e4.4","title":"Implement expand primitive handler","description":"Handle expand beads by loading and baking templates with ephemeral support.","notes":"## Behavior\n1. Load referenced template\n2. Merge variables (including output references)\n3. Bake template into child beads\n4. **If ephemeral: true, label beads with meow:ephemeral**\n5. Wire dependencies\n6. Set assignee on children\n7. Close expand bead\n\n## Ephemeral Beads\nWhen `ephemeral: true` on expand or in template meta:\n- Child beads get `labels: [\"meow:ephemeral\"]`\n- They execute normally\n- After completion, can be auto-cleaned\n- Hidden in `bd list` by default\n\n## Example\n```yaml\ntype: expand\ntemplate: \"call-implement\"\nephemeral: true  # Machinery beads, not work beads\nvariables:\n  work_bead: \"{{select-task.outputs.work_bead}}\"\n```\n\n## Recursive Expansion\nChild expand beads get processed in later iterations.\n\n## Acceptance Criteria\n- [ ] Template loads correctly\n- [ ] Variables merge correctly (including output refs)\n- [ ] Child beads created\n- [ ] **Ephemeral flag propagates to labels**\n- [ ] Recursive expansion works\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["expand","primitives"],"dependencies":[{"issue_id":"meow-e4.4","depends_on_id":"meow-e2.4","type":"blocks","created_at":"2026-01-07T03:14:32.218015448-05:00","created_by":"ubuntu"},{"issue_id":"meow-e4.4","depends_on_id":"meow-e3.2","type":"blocks","created_at":"2026-01-07T03:14:32.307659156-05:00","created_by":"ubuntu"}]}
{"id":"meow-e4.5","title":"Implement stop primitive handler","description":"Handle stop beads by killing agent tmux sessions.","notes":"## Behavior\n1. If graceful: send interrupt, wait, then force kill\n2. Kill tmux session\n3. Update agent state to stopped\n4. Close bead\n\n## Acceptance Criteria\n- [ ] Graceful stop sends interrupt first\n- [ ] Force kill after timeout\n- [ ] Agent state updated\n- [ ] Works if agent not running\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["primitives","stop"],"dependencies":[{"issue_id":"meow-e4.5","depends_on_id":"meow-e5.1","type":"blocks","created_at":"2026-01-07T03:14:32.396395228-05:00","created_by":"ubuntu"}]}
{"id":"meow-e4.6","title":"Implement start primitive handler","description":"Handle start beads by spawning agents in tmux with optional resume.","notes":"## Behavior\n1. Create tmux session\n2. Set working directory (can be from prior bead output)\n3. Set environment\n4. **If resume_session: start Claude with --resume**\n5. Otherwise: start Claude fresh\n6. Wait for ready\n7. Inject meow prime\n8. Update agent state\n9. Close bead\n\n## Resume Support (replaces old resume primitive)\n```yaml\ntype: start\nagent: \"claude-1\"\nresume_session: \"{{save-session.outputs.session_id}}\"\nworkdir: \".\"\n```\n\nThis composes checkpoint/resume:\n- code bead saves session ID\n- start bead uses it to resume\n\n## Fresh Start\n```yaml\ntype: start\nagent: \"claude-2\"\nworkdir: \"{{setup-worktree.outputs.path}}\"\n```\n\n## Acceptance Criteria\n- [ ] Creates tmux session\n- [ ] Sets workdir (including from output references)\n- [ ] **Starts Claude with --resume when resume_session set**\n- [ ] Starts Claude fresh when no resume_session\n- [ ] Detects when ready\n- [ ] Injects meow prime\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["primitives","start"],"dependencies":[{"issue_id":"meow-e4.6","depends_on_id":"meow-e5.1","type":"blocks","created_at":"2026-01-07T03:14:32.486939134-05:00","created_by":"ubuntu"}]}
{"id":"meow-e4.7","title":"Implement ephemeral bead cleanup","description":"Clean up ephemeral beads after template completion.","notes":"## Behavior\nWhen a template with ephemeral beads completes:\n1. Detect all beads with `meow:ephemeral` label\n2. Based on cleanup config, either:\n   - on_complete: auto-delete closed ephemeral beads\n   - manual: wait for `meow clean --ephemeral`\n   - never: keep for debugging\n\n## Why Ephemeral Beads?\nTemplate steps like \"load-context\", \"write-tests\" are operational\nmachinery, not work items. Cleaning them keeps bead history focused\non actual deliverables.\n\n## Config\n```toml\n[cleanup]\nephemeral = \"on_complete\"  # or \"manual\" or \"never\"\n```\n\n## Acceptance Criteria\n- [ ] Detects ephemeral beads by label\n- [ ] Respects cleanup config\n- [ ] Cleans only closed ephemeral beads\n- [ ] `meow clean --ephemeral` works for manual mode\n","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["ephemeral","primitives"],"dependencies":[{"issue_id":"meow-e4.7","depends_on_id":"meow-e4.4","type":"blocks","created_at":"2026-01-07T03:14:32.575443146-05:00","created_by":"ubuntu"},{"issue_id":"meow-e4.7","depends_on_id":"meow-e1.5","type":"blocks","created_at":"2026-01-07T03:14:32.665093943-05:00","created_by":"ubuntu"}]}
{"id":"meow-e5","title":"Agent Management: tmux and lifecycle","description":"Manage agent lifecycle via tmux.","notes":"## Success Criteria\n- Can create/kill tmux sessions\n- Can send commands to sessions\n- Can detect if sessions are alive\n- Agent state reflects reality\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-07T03:12:48.457391798-05:00","updated_at":"2026-01-07T03:12:48.457391798-05:00","labels":["agents","epic","phase-2"],"dependencies":[{"issue_id":"meow-e5","depends_on_id":"meow-e3","type":"blocks","created_at":"2026-01-07T03:14:32.754467801-05:00","created_by":"ubuntu"}]}
{"id":"meow-e5.0","title":"Validate tmux availability and version","description":"Check tmux is installed and meets version requirements at startup.","notes":"## Why This Task\nMEOW relies heavily on tmux for agent session management. If tmux is missing\nor too old, users will get confusing errors deep in execution.\n\n## Validation Rules\n- tmux must be in PATH\n- Version \u003e= 3.0 (required for -c workdir flag)\n- Provide clear, actionable error if validation fails\n\n## Implementation\n```go\nfunc ValidateTmux() error {\n    // Check existence\n    path, err := exec.LookPath(\"tmux\")\n    if err != nil {\n        return \u0026MeowError{\n            Code:    \"AGENT_003\",\n            Message: \"tmux not found in PATH\",\n            Details: map[string]any{\n                \"hint\": \"Install tmux: apt install tmux / brew install tmux\",\n            },\n        }\n    }\n\n    // Check version\n    out, _ := exec.Command(\"tmux\", \"-V\").Output()\n    version := parseTmuxVersion(string(out)) // e.g., \"tmux 3.3a\" -\u003e 3.3\n    if version \u003c 3.0 {\n        return \u0026MeowError{\n            Code:    \"AGENT_004\",\n            Message: fmt.Sprintf(\"tmux version %v too old (need \u003e= 3.0)\", version),\n            Details: map[string]any{\n                \"current\": version,\n                \"required\": 3.0,\n                \"hint\": \"Upgrade tmux to 3.0 or later\",\n            },\n        }\n    }\n\n    return nil\n}\n```\n\n## Call Site\nCalled at orchestrator startup, before any agent operations.\n\n## Acceptance Criteria\n- [ ] Detects missing tmux with helpful message\n- [ ] Detects old tmux version with upgrade instructions\n- [ ] Returns nil for valid tmux installation\n- [ ] Unit test with mock exec\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["agents","prerequisite","validation"],"dependencies":[{"issue_id":"meow-e5.0","depends_on_id":"meow-e1.7","type":"blocks","created_at":"2026-01-07T03:14:32.843733014-05:00","created_by":"ubuntu"}]}
{"id":"meow-e5.1","title":"Implement tmux wrapper library","description":"Create a Go wrapper around tmux commands.","notes":"## Interface\n- NewSession, KillSession, SessionExists, ListSessions\n- SendKeys, SendKeysLiteral\n- CapturePane, SetEnv\n\n## Acceptance Criteria\n- [ ] Create session in directory\n- [ ] Kill session cleanly\n- [ ] Check if session exists\n- [ ] Send text to session\n- [ ] Capture pane output\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["agents","tmux"],"dependencies":[{"issue_id":"meow-e5.1","depends_on_id":"meow-e5.0","type":"blocks","created_at":"2026-01-07T03:14:32.933515295-05:00","created_by":"ubuntu"},{"issue_id":"meow-e5.1","depends_on_id":"meow-e1.2","type":"blocks","created_at":"2026-01-07T03:14:33.016869185-05:00","created_by":"ubuntu"}]}
{"id":"meow-e5.2","title":"Implement agent state storage","description":"Manage persistent agent state.","notes":"## Storage\n.meow/agents.json with agent records\n\n## Interface\nGet, Set, Update, Delete, List, ListByStatus\nLoad, Save\n\n## Acceptance Criteria\n- [ ] Persist agent state to disk\n- [ ] Atomic writes for safety\n- [ ] Thread-safe access\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["agents","state"],"dependencies":[{"issue_id":"meow-e5.2","depends_on_id":"meow-e1.2","type":"blocks","created_at":"2026-01-07T03:14:33.111754683-05:00","created_by":"ubuntu"}]}
{"id":"meow-e5.3","title":"Implement agent spawning logic","description":"Higher-level agent spawning that coordinates tmux and state.","notes":"## Spawn Flow\n1. Check if agent already exists\n2. Create tmux session\n3. Configure environment\n4. Start Claude\n5. Wait for ready\n6. Inject initial prompt\n7. Update agent state\n\n## Acceptance Criteria\n- [ ] Creates complete agent setup\n- [ ] Handles existing agent\n- [ ] Cleans up on failure\n- [ ] Updates state correctly\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["agents","spawn"],"dependencies":[{"issue_id":"meow-e5.3","depends_on_id":"meow-e5.1","type":"blocks","created_at":"2026-01-07T03:14:33.199682711-05:00","created_by":"ubuntu"},{"issue_id":"meow-e5.3","depends_on_id":"meow-e5.2","type":"blocks","created_at":"2026-01-07T03:14:33.290518593-05:00","created_by":"ubuntu"}]}
{"id":"meow-e5.4","title":"Implement agent health monitoring","description":"Monitor agent health and detect crashes/stuck agents.","notes":"## Health Checks\n- Session exists (tmux has-session)\n- Activity check (recent progress)\n- Stuck detection (same bead too long)\n\n## Acceptance Criteria\n- [ ] Detects crashed sessions\n- [ ] Detects stuck agents\n- [ ] Updates state on crash\n","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["agents","monitoring"],"dependencies":[{"issue_id":"meow-e5.4","depends_on_id":"meow-e5.3","type":"blocks","created_at":"2026-01-07T03:14:33.385427189-05:00","created_by":"ubuntu"}]}
{"id":"meow-e6","title":"Condition System: Blocking, timeouts, and gates","description":"Deep implementation of blocking conditions.","notes":"## Key Feature\nConditions can block indefinitely - this enables human gates, CI waits, etc.\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-07T03:12:48.457391798-05:00","updated_at":"2026-01-07T03:12:48.457391798-05:00","labels":["conditions","epic","phase-3"],"dependencies":[{"issue_id":"meow-e6","depends_on_id":"meow-e4","type":"blocks","created_at":"2026-01-07T03:14:33.482137985-05:00","created_by":"ubuntu"}]}
{"id":"meow-e6.1","title":"Implement blocking shell execution with cancellation","description":"Shell commands that block indefinitely with cancellation support.","notes":"Must support cancellation via context.\nRun in goroutines to not block main loop.\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["blocking","conditions"]}
{"id":"meow-e6.2","title":"Implement condition timeout handling","description":"Timeouts specified on conditions.","notes":"On timeout, expand on_timeout template (or on_false if not specified).\n","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["conditions","timeout"],"dependencies":[{"issue_id":"meow-e6.2","depends_on_id":"meow-e6.1","type":"blocks","created_at":"2026-01-07T03:14:33.569531385-05:00","created_by":"ubuntu"}]}
{"id":"meow-e6.3","title":"Implement helper commands (wait-approve, wait-file, etc.)","description":"Convenience commands for common blocking patterns.","notes":"Commands:\n- meow wait-approve --bead \u003cid\u003e\n- meow wait-file \u003cpath\u003e\n- meow wait-bead \u003cid\u003e --status closed\n- meow context-usage --threshold N --format exit-code\n","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["conditions","helpers"],"dependencies":[{"issue_id":"meow-e6.3","depends_on_id":"meow-e6.1","type":"blocks","created_at":"2026-01-07T03:14:33.662016544-05:00","created_by":"ubuntu"}]}
{"id":"meow-e6.4","title":"Implement gate approval flow","description":"Human approval unblocking via meow approve.","notes":"`meow approve \u003cbead\u003e` creates marker that `meow wait-approve` detects.\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["conditions","gates"],"dependencies":[{"issue_id":"meow-e6.4","depends_on_id":"meow-e6.1","type":"blocks","created_at":"2026-01-07T03:14:33.755085213-05:00","created_by":"ubuntu"}]}
{"id":"meow-e6.5","title":"Implement meow test-runner helper command","description":"Project-type-aware test runner for TDD workflow conditions.","notes":"## Why This Task\nThe implement-tdd template needs to run tests but different projects use\ndifferent test frameworks (npm test, go test, pytest, cargo test, etc.).\nHard-coding framework detection in templates is fragile.\n\n## Solution\n`meow test-runner` abstracts the test command based on project detection.\n\n## Usage\n```bash\nmeow test-runner                    # Run tests, exit 0 if pass\nmeow test-runner --expect-fail      # Exit 0 if tests FAIL (for TDD)\nmeow test-runner --framework npm    # Force specific framework\n```\n\n## Project Detection\n1. If `package.json` exists and has `scripts.test`: npm test\n2. If `go.mod` exists: go test ./...\n3. If `Cargo.toml` exists: cargo test\n4. If `pytest.ini` or `setup.py` exists: pytest\n5. If `Makefile` with `test` target: make test\n6. Fallback: error with helpful message\n\n## Implementation\n```go\nfunc (c *TestRunnerCmd) Run() error {\n    framework := c.detectFramework()\n    if framework == \"\" {\n        return \u0026MeowError{\n            Code:    \"TEST_001\",\n            Message: \"Could not detect test framework\",\n            Details: map[string]any{\n                \"hint\": \"Use --framework to specify manually\",\n                \"supported\": []string{\"npm\", \"go\", \"cargo\", \"pytest\", \"make\"},\n            },\n        }\n    }\n\n    cmd := c.buildCommand(framework)\n    exitCode := runCommand(cmd)\n\n    if c.expectFail {\n        // For TDD: success means tests failed as expected\n        if exitCode != 0 {\n            return nil  // Tests failed = success\n        }\n        return fmt.Errorf(\"tests passed unexpectedly\")\n    }\n\n    if exitCode != 0 {\n        return fmt.Errorf(\"tests failed with exit code %d\", exitCode)\n    }\n    return nil\n}\n```\n\n## Use in Templates\n```toml\n# In implement-tdd.toml\n[[steps]]\nid = \"verify-fail\"\ntype = \"condition\"\ncondition = \"meow test-runner --expect-fail\"  # Clean, project-agnostic\n```\n\n## Acceptance Criteria\n- [ ] Detects npm projects\n- [ ] Detects Go projects\n- [ ] Detects Cargo projects\n- [ ] --expect-fail inverts exit code\n- [ ] --framework overrides detection\n- [ ] Helpful error when detection fails\n- [ ] Unit tests for each detection path\n","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["conditions","helpers","testing"],"dependencies":[{"issue_id":"meow-e6.5","depends_on_id":"meow-e6.1","type":"blocks","created_at":"2026-01-07T03:14:33.842319108-05:00","created_by":"ubuntu"}]}
{"id":"meow-e7","title":"Output Binding \u0026 Session Management","description":"Implement output binding between beads and session management for\ncheckpoint/resume composition.\n","notes":"## Why This Epic\nOutput binding is the key capability that enables:\n- Dynamic worktree paths from code → start\n- Task selection outputs from Claude → orchestrator\n- Session IDs from code → start (for resume)\n\n## Key Components\n1. Output storage on beads\n2. Output reference resolution in variable substitution\n3. meow session-id command for checkpoint composition\n4. meow close --output for task outputs\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-07T03:12:48.457391798-05:00","updated_at":"2026-01-07T03:12:48.457391798-05:00","labels":["epic","outputs","phase-3","session"],"dependencies":[{"issue_id":"meow-e7","depends_on_id":"meow-e4","type":"blocks","created_at":"2026-01-07T03:14:33.933739685-05:00","created_by":"ubuntu"},{"issue_id":"meow-e7","depends_on_id":"meow-e5","type":"blocks","created_at":"2026-01-07T03:14:34.024222144-05:00","created_by":"ubuntu"}]}
{"id":"meow-e7.1","title":"Implement meow session-id command","description":"Command to discover and output Claude's session ID.","notes":"## Purpose\nThis command enables checkpoint composition:\n```yaml\ntype: code\ncode: meow session-id --agent {{agent}}\noutputs:\n  session_id: stdout\n```\n\nThe output can then be used by a start bead:\n```yaml\ntype: start\nresume_session: \"{{save-session.outputs.session_id}}\"\n```\n\n## Session ID Discovery\n- Read $MEOW_SESSION_ID if set (via meow prime --hook)\n- Or find latest in ~/.claude/sessions/ for agent\n- Or query tmux session for environment\n\n## Usage\n```bash\nmeow session-id              # Current agent\nmeow session-id --agent X    # Specific agent\nmeow session-id --save       # Also save to .meow/sessions/\n```\n\n## Acceptance Criteria\n- [ ] Discovers session ID from environment\n- [ ] Falls back to session file discovery\n- [ ] Outputs clean session ID to stdout\n- [ ] Works in code bead context\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["cli","session"],"dependencies":[{"issue_id":"meow-e7.1","depends_on_id":"meow-e5.2","type":"blocks","created_at":"2026-01-07T03:14:34.11118274-05:00","created_by":"ubuntu"}]}
{"id":"meow-e7.2","title":"Implement output storage on beads","description":"Store captured outputs on bead records.","notes":"## Storage Format\n```json\n{\n  \"id\": \"create-worktree\",\n  \"type\": \"code\",\n  \"status\": \"closed\",\n  \"outputs\": {\n    \"path\": \"~/worktrees/worker\",\n    \"sha\": \"abc123\"\n  }\n}\n```\n\n## Requirements\n- Outputs persist in bead file\n- Outputs queryable via bd show\n- Outputs survive orchestrator restart\n\n## Acceptance Criteria\n- [ ] Code beads store captured outputs\n- [ ] Task beads store validated outputs\n- [ ] Outputs visible in bd show\n- [ ] Outputs persist across restarts\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["outputs","storage"]}
{"id":"meow-e7.3","title":"Implement output reference resolution","description":"Resolve {{bead.outputs.field}} references during template processing.","notes":"## Resolution Process\nWhen processing a template with {{bead_id.outputs.field}}:\n1. Find bead with matching ID\n2. Check bead is closed (outputs available)\n3. Look up outputs.field\n4. Substitute value\n\n## Error Cases\n- Bead not found → error with available beads\n- Bead not closed → error (dependency issue)\n- Output field not found → error with available fields\n\n## Acceptance Criteria\n- [ ] Resolves valid output references\n- [ ] Clear error for missing bead\n- [ ] Clear error for unclosed bead\n- [ ] Clear error for missing field\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["outputs","resolution"],"dependencies":[{"issue_id":"meow-e7.3","depends_on_id":"meow-e7.2","type":"blocks","created_at":"2026-01-07T03:14:34.202956446-05:00","created_by":"ubuntu"},{"issue_id":"meow-e7.3","depends_on_id":"meow-e2.2","type":"blocks","created_at":"2026-01-07T03:14:34.293578702-05:00","created_by":"ubuntu"}]}
{"id":"meow-e7.4","title":"Implement output type validators","description":"Implement validators for all output types including bead_id.","notes":"## Why This Task is Critical\nOutput validation is what makes Claude's outputs reliable. Without proper\nvalidation, typos and hallucinated bead IDs would break workflows.\n\n## Output Types to Validate\n```go\ntype OutputType string\n\nconst (\n    TypeString    OutputType = \"string\"\n    TypeStringArr OutputType = \"string[]\"\n    TypeNumber    OutputType = \"number\"\n    TypeBoolean   OutputType = \"boolean\"\n    TypeJSON      OutputType = \"json\"\n    TypeBeadID    OutputType = \"bead_id\"\n    TypeBeadIDArr OutputType = \"bead_id[]\"\n    TypeFilePath  OutputType = \"file_path\"\n)\n```\n\n## Validator Interface\n```go\ntype OutputValidator interface {\n    Validate(value string, ctx ValidationContext) error\n    TypeName() string\n}\n\ntype ValidationContext struct {\n    BeadsDir    string\n    WorkDir     string\n    BeadLookup  func(id string) (*types.Bead, bool)\n}\n```\n\n## bead_id Validator (Most Important)\n```go\ntype BeadIDValidator struct{}\n\nfunc (v *BeadIDValidator) Validate(value string, ctx ValidationContext) error {\n    // Check format\n    if !strings.HasPrefix(value, \"bd-\") {\n        return fmt.Errorf(\"bead_id must start with 'bd-', got '%s'\", value)\n    }\n\n    // Check existence\n    bead, found := ctx.BeadLookup(value)\n    if !found {\n        // Suggest similar beads\n        suggestions := findSimilarBeads(value, ctx)\n        return \u0026BeadNotFoundError{\n            ID:          value,\n            Suggestions: suggestions,\n        }\n    }\n\n    return nil\n}\n```\n\n## file_path Validator\n```go\ntype FilePathValidator struct{}\n\nfunc (v *FilePathValidator) Validate(value string, ctx ValidationContext) error {\n    path := value\n    if !filepath.IsAbs(path) {\n        path = filepath.Join(ctx.WorkDir, path)\n    }\n\n    if _, err := os.Stat(path); os.IsNotExist(err) {\n        return fmt.Errorf(\"file does not exist: %s\", value)\n    }\n\n    return nil\n}\n```\n\n## Error Messages\nMust be helpful and actionable:\n```\nError: Output validation failed for 'work_bead'\n\n  Value: \"bd-task-999\"\n  Type: bead_id\n  Error: Bead 'bd-task-999' does not exist\n\n  Did you mean one of these?\n    • bd-task-001 \"Implement auth\"\n    • bd-task-002 \"Add validation\"\n    • bd-task-003 \"Write tests\"\n\nHint: Run 'bd list --status=open' to see available beads\n```\n\n## Acceptance Criteria\n- [ ] All 8 types have working validators\n- [ ] bead_id checks actual bead existence\n- [ ] file_path checks file existence\n- [ ] Suggestions provided for typos\n- [ ] Error messages are actionable\n- [ ] Unit tests for each validator\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["critical","outputs","validation"],"dependencies":[{"issue_id":"meow-e7.4","depends_on_id":"meow-e7.2","type":"blocks","created_at":"2026-01-07T03:14:34.382248765-05:00","created_by":"ubuntu"}]}
{"id":"meow-e8","title":"Integration: Beads, hooks, recovery","description":"Integration with external systems.","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-07T03:12:48.457391798-05:00","updated_at":"2026-01-07T03:12:48.457391798-05:00","labels":["epic","integration","phase-3"],"dependencies":[{"issue_id":"meow-e8","depends_on_id":"meow-e3","type":"blocks","created_at":"2026-01-07T03:14:34.469376424-05:00","created_by":"ubuntu"},{"issue_id":"meow-e8","depends_on_id":"meow-e4","type":"blocks","created_at":"2026-01-07T03:14:34.56063549-05:00","created_by":"ubuntu"}]}
{"id":"meow-e8.1","title":"Implement beads integration","description":"Integrate with beads CLI for bead operations.","notes":"## Integration Points\nMEOW uses the `bd` CLI for all bead operations. This task integrates:\n\n### Bead Creation (template baking)\n```go\nfunc createBead(bead *types.Bead) error {\n    args := []string{\"create\",\n        \"--id\", bead.ID,\n        \"--type\", bead.Type,\n        \"--title\", bead.Title,\n    }\n    if bead.Parent != \"\" {\n        args = append(args, \"--parent\", bead.Parent)\n    }\n    for _, dep := range bead.Needs {\n        args = append(args, \"--dep\", dep)\n    }\n    return exec.Command(\"bd\", args...).Run()\n}\n```\n\n### Status Updates\n```go\nfunc updateBeadStatus(id string, status string) error {\n    return exec.Command(\"bd\", \"update\", id, \"--status\", status).Run()\n}\n```\n\n### Reading Beads\n```go\nfunc getBead(id string) (*types.Bead, error) {\n    out, err := exec.Command(\"bd\", \"show\", id, \"--format\", \"json\").Output()\n    if err != nil {\n        return nil, err\n    }\n    var bead types.Bead\n    json.Unmarshal(out, \u0026bead)\n    return \u0026bead, nil\n}\n```\n\n### Querying\n```go\nfunc listBeads(status string) ([]types.Bead, error) {\n    args := []string{\"list\", \"--format\", \"json\"}\n    if status != \"\" {\n        args = append(args, \"--status\", status)\n    }\n    // ...\n}\n```\n\n## Output Storage\nWhen storing outputs on beads:\n```go\nfunc storeOutputs(beadID string, outputs map[string]string) error {\n    outputJSON, _ := json.Marshal(outputs)\n    return exec.Command(\"bd\", \"update\", beadID,\n        \"--set\", fmt.Sprintf(\"outputs=%s\", outputJSON)).Run()\n}\n```\n\n## Acceptance Criteria\n- [ ] bd create integrates correctly\n- [ ] bd update for status changes\n- [ ] bd show for reading with JSON\n- [ ] bd list for queries\n- [ ] Output storage works\n- [ ] Error handling for bd failures\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["beads","integration"],"dependencies":[{"issue_id":"meow-e8.1","depends_on_id":"meow-e1.2","type":"blocks","created_at":"2026-01-07T03:14:34.649846479-05:00","created_by":"ubuntu"}]}
{"id":"meow-e8.2","title":"Implement Claude Code hooks setup","description":"Configure .claude/settings.json with MEOW hooks.","notes":"- SessionStart: meow prime --hook\n- Stop: meow prime --format prompt\n\nmeow init should set this up.\n","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["hooks","integration"]}
{"id":"meow-e8.3","title":"Test and validate crash recovery","description":"Integration test for crash recovery.","notes":"1. Start workflow\n2. Kill orchestrator mid-execution\n3. Restart\n4. Verify continues correctly\n","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["integration","recovery"],"dependencies":[{"issue_id":"meow-e8.3","depends_on_id":"meow-e3.4","type":"blocks","created_at":"2026-01-07T03:14:34.743798036-05:00","created_by":"ubuntu"}]}
{"id":"meow-e8.4","title":"Implement git worktree support","description":"Helper functions for git worktree operations in code beads.","notes":"## Why Worktrees Matter\nWorktrees allow child agents to work in isolated branches without\naffecting the parent's working directory. This enables:\n- Parallel work on different features\n- Clean separation of concerns\n- Easy cleanup after completion\n\n## Worktree Path Convention\n```\n.meow/worktrees/{agent-id}/\n```\n\n## Helper Functions\n```go\n// Create worktree for agent\nfunc CreateWorktree(agentID string, branch string) (string, error) {\n    path := filepath.Join(\".meow/worktrees\", agentID)\n    branchName := fmt.Sprintf(\"meow/%s\", agentID)\n\n    cmd := exec.Command(\"git\", \"worktree\", \"add\",\n        \"-b\", branchName,\n        path,\n        \"HEAD\")\n\n    if err := cmd.Run(); err != nil {\n        return \"\", fmt.Errorf(\"failed to create worktree: %w\", err)\n    }\n\n    return path, nil\n}\n\n// Remove worktree and branch\nfunc RemoveWorktree(agentID string) error {\n    path := filepath.Join(\".meow/worktrees\", agentID)\n    branchName := fmt.Sprintf(\"meow/%s\", agentID)\n\n    // Remove worktree\n    exec.Command(\"git\", \"worktree\", \"remove\", path).Run()\n\n    // Delete branch (force if needed)\n    exec.Command(\"git\", \"branch\", \"-D\", branchName).Run()\n\n    return nil\n}\n\n// Check if worktree exists\nfunc WorktreeExists(agentID string) bool {\n    path := filepath.Join(\".meow/worktrees\", agentID)\n    _, err := os.Stat(path)\n    return err == nil\n}\n```\n\n## Usage in call Template\nThe call template uses worktrees when `use_worktree = true`:\n```toml\n[[steps]]\nid = \"setup-worktree\"\ntype = \"code\"\ncode = '''\nmeow worktree create {{child}}\n'''\noutputs = { workdir = \"stdout\" }\n```\n\n## CLI Commands (optional)\n```bash\nmeow worktree create \u003cagent\u003e   # Create and output path\nmeow worktree remove \u003cagent\u003e   # Remove worktree and branch\nmeow worktree list             # List active worktrees\n```\n\n## Acceptance Criteria\n- [ ] Create worktree at .meow/worktrees/{agent}/\n- [ ] Remove worktree and cleanup branch\n- [ ] Handle existing worktree gracefully\n- [ ] Output path to stdout for capture\n- [ ] Unit tests with mock git\n","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["git","integration"]}
{"id":"meow-e9","title":"Default Templates: MVP template library","description":"Ship useful default templates.","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-07T03:12:48.457391798-05:00","updated_at":"2026-01-07T03:12:48.457391798-05:00","labels":["epic","phase-4","templates"],"dependencies":[{"issue_id":"meow-e9","depends_on_id":"meow-e2","type":"blocks","created_at":"2026-01-07T03:14:34.834779324-05:00","created_by":"ubuntu"}]}
{"id":"meow-e9.1","title":"Create work-loop template","description":"Main orchestration loop template.","notes":"Check for work → select → implement → check context → loop.\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["templates","work-loop"]}
{"id":"meow-e9.3","title":"Create human-gate template","description":"Blocking approval template.","notes":"prepare-summary → notify → await-approval → record-decision\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["gate","templates"]}
{"id":"meow-e9.4","title":"Create refresh and handoff templates","description":"Context refresh templates.","notes":"refresh: stop → start\nhandoff: write-notes → stop → start\n","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["refresh","templates"]}
{"id":"meow-e9.5","title":"Create context-check template","description":"Check context and maybe refresh.","notes":"## Template: context-check.toml\n```toml\n[meta]\nname = \"context-check\"\ndescription = \"Check context usage and trigger refresh if needed\"\n\n[variables]\nagent = { required = true }\nthreshold = { default = 70, description = \"Context % threshold\" }\n\n[[steps]]\nid = \"check\"\ntype = \"condition\"\ncondition = \"meow context-usage --agent {{agent}} --threshold {{threshold}} --format exit-code\"\non_true:\n  template = \"handoff\"\n  variables = { agent = \"{{agent}}\" }\non_false:\n  inline = []  # Continue without refresh\n```\n\n## Acceptance Criteria\n- [ ] Template parses and validates\n- [ ] Threshold is configurable\n- [ ] Triggers handoff when context high\n- [ ] Unit test for template validation\n","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["context","templates"]}
{"id":"meow-e9.6","title":"Create call template (parent/child orchestration)","description":"Template for spawning child agent, running workflow, resuming parent.","notes":"## Why This Template is Critical\nThe `call` template is the foundation for parent/child agent orchestration.\nIt demonstrates the composed checkpoint/resume pattern using the 6 primitives.\n\n## Template: call.toml\n```toml\n[meta]\nname = \"call\"\ndescription = \"Spawn child agent for sub-workflow, then resume parent\"\nephemeral = true  # All steps are operational machinery\n\n[variables]\nparent = { required = true, description = \"Parent agent ID\" }\nchild = { required = true, description = \"Child agent ID\" }\ntemplate = { required = true, description = \"Template for child to execute\" }\ntemplate_vars = { default = {}, description = \"Variables for child template\" }\nuse_worktree = { default = false, description = \"Create git worktree for child\" }\n\n# --- Save parent session ---\n[[steps]]\nid = \"save-parent-session\"\ntype = \"code\"\ncode = \"meow session-id --agent {{parent}}\"\noutputs = { session_id = \"stdout\" }\n\n[[steps]]\nid = \"stop-parent\"\ntype = \"stop\"\nagent = \"{{parent}}\"\nneeds = [\"save-parent-session\"]\n\n# --- Setup child workspace ---\n[[steps]]\nid = \"setup-worktree\"\ntype = \"code\"\nneeds = [\"stop-parent\"]\ncode = '''\nif [ \"{{use_worktree}}\" = \"true\" ]; then\n    git worktree add -b meow/{{child}} .meow/worktrees/{{child}} HEAD\n    echo \".meow/worktrees/{{child}}\"\nelse\n    pwd\nfi\n'''\noutputs = { workdir = \"stdout\" }\n\n# --- Start child ---\n[[steps]]\nid = \"start-child\"\ntype = \"start\"\nagent = \"{{child}}\"\nworkdir = \"{{setup-worktree.outputs.workdir}}\"\nneeds = [\"setup-worktree\"]\n\n# --- Child executes the work ---\n[[steps]]\nid = \"child-work\"\ntype = \"expand\"\ntemplate = \"{{template}}\"\nvariables = \"{{template_vars}}\"\nassignee = \"{{child}}\"\nneeds = [\"start-child\"]\n\n# --- Stop child ---\n[[steps]]\nid = \"stop-child\"\ntype = \"stop\"\nagent = \"{{child}}\"\nneeds = [\"child-work\"]\n\n# --- Cleanup worktree ---\n[[steps]]\nid = \"cleanup-worktree\"\ntype = \"code\"\nneeds = [\"stop-child\"]\ncode = '''\nif [ \"{{use_worktree}}\" = \"true\" ]; then\n    git worktree remove .meow/worktrees/{{child}} || true\n    git branch -d meow/{{child}} || true\nfi\n'''\n\n# --- Resume parent ---\n[[steps]]\nid = \"resume-parent\"\ntype = \"start\"\nagent = \"{{parent}}\"\nworkdir = \".\"\nresume_session = \"{{save-parent-session.outputs.session_id}}\"\nneeds = [\"cleanup-worktree\"]\n```\n\n## Key Features Demonstrated\n1. Output binding: session_id and workdir captured and used\n2. Composed checkpoint/resume: code → start with resume_session\n3. Ephemeral: all steps are machinery, not work\n4. Worktree isolation: optional per-agent workspace\n\n## Acceptance Criteria\n- [ ] Template parses and validates\n- [ ] Variables substitute correctly\n- [ ] Output references resolve\n- [ ] E2E test with mock agents\n- [ ] Unit test for template validation\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["call","critical","templates"],"dependencies":[{"issue_id":"meow-e9.6","depends_on_id":"meow-e7.1","type":"blocks","created_at":"2026-01-07T03:14:34.927608572-05:00","created_by":"ubuntu"},{"issue_id":"meow-e9.6","depends_on_id":"meow-e7.2","type":"blocks","created_at":"2026-01-07T03:14:35.018756942-05:00","created_by":"ubuntu"},{"issue_id":"meow-e9.6","depends_on_id":"meow-e7.3","type":"blocks","created_at":"2026-01-07T03:14:35.109804641-05:00","created_by":"ubuntu"}]}
{"id":"meow-e9.7","title":"Create implement-tdd template","description":"TDD workflow template that works with a work bead.","notes":"## Template: implement-tdd.toml\n```toml\n[meta]\nname = \"implement-tdd\"\ndescription = \"TDD implementation workflow\"\nephemeral = true  # Steps are operational\n\n[variables]\nwork_bead = { required = true, type = \"bead_id\", description = \"The work bead to implement\" }\n\n[[steps]]\nid = \"load-context\"\ntype = \"task\"\ntitle = \"Load context for {{work_bead}}\"\ndescription = |\n  1. Run: bd show {{work_bead}}\n  2. Understand the requirements\n  3. Identify relevant files\n  4. Update notes with your understanding\n\n[[steps]]\nid = \"write-tests\"\ntype = \"task\"\ntitle = \"Write failing tests\"\ndescription = \"Write tests that will fail until implementation is complete\"\nneeds = [\"load-context\"]\n\n[[steps]]\nid = \"verify-fail\"\ntype = \"condition\"\ncondition = \"meow test-runner --expect-fail\"  # Project-type agnostic\nneeds = [\"write-tests\"]\non_true:\n  inline = []  # Tests fail as expected, continue\non_false:\n  inline = [\n    { id = \"fix-tests\", type = \"task\", title = \"Tests passed unexpectedly - revise tests\" }\n  ]\n\n[[steps]]\nid = \"implement\"\ntype = \"task\"\ntitle = \"Write implementation\"\ndescription = \"Write the minimum code to make tests pass\"\nneeds = [\"verify-fail\"]\n\n[[steps]]\nid = \"verify-pass\"\ntype = \"condition\"\ncondition = \"meow test-runner\"  # Project-type agnostic\nneeds = [\"implement\"]\non_true:\n  inline = []  # Tests pass, continue\non_false:\n  inline = [\n    { id = \"fix-impl\", type = \"task\", title = \"Tests still failing - fix implementation\" }\n  ]\n\n[[steps]]\nid = \"commit\"\ntype = \"task\"\ntitle = \"Commit changes\"\ndescription = \"Create a descriptive commit for the changes\"\nneeds = [\"verify-pass\"]\n\n[[steps]]\nid = \"close-work-bead\"\ntype = \"code\"\ncode = \"bd close {{work_bead}} --notes 'Implemented via implement-tdd template'\"\nneeds = [\"commit\"]\n```\n\n## Acceptance Criteria\n- [ ] Template parses and validates\n- [ ] work_bead variable is type-checked as bead_id\n- [ ] Verify-fail/verify-pass conditions work\n- [ ] Work bead is closed at end\n- [ ] Unit test for template validation\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-07T03:12:48.465692926-05:00","updated_at":"2026-01-07T03:12:48.465692926-05:00","labels":["implement","tdd","templates"]}

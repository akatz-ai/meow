# TDD (Test-Driven Development) Workflow Template
# Implements the red-green-refactor cycle.
#
# Usage:
#   meow run .meow/templates/tdd.meow.toml --var feature="user authentication"
#
# Steps:
#   1. write-test   - Write failing tests first (RED)
#   2. make-pass    - Write code to pass tests (GREEN)
#   3. refactor     - Clean up the code (REFACTOR)
#   4. commit       - Commit the changes

[main]
name = "tdd-workflow"
description = "Test-Driven Development workflow"
ephemeral = true

[main.variables]
feature = { required = true, description = "Feature or functionality to implement" }

[[main.steps]]
id = "write-test"
type = "task"
title = "Write failing tests for: {{feature}}"
instructions = """
## RED Phase: Write Failing Tests

Write tests that define the expected behavior for: {{feature}}

### Guidelines:
1. Start with the simplest test case
2. Test one behavior per test
3. Use descriptive test names
4. Cover edge cases

### Checklist:
- [ ] Happy path test
- [ ] Edge case tests
- [ ] Error handling tests

### Verify:
Run tests - they should FAIL (that's expected!)

When tests are written, close this step:
  meow close <bead-id>
"""

[[main.steps]]
id = "make-pass"
type = "task"
title = "Implement: {{feature}}"
needs = ["write-test"]
instructions = """
## GREEN Phase: Make Tests Pass

Write the minimum code to make all tests pass.

### Guidelines:
1. Don't over-engineer - just make it work
2. Follow existing code patterns
3. Keep it simple

### Process:
1. Run tests to see what's failing
2. Fix one failing test at a time
3. Run tests again
4. Repeat until all pass

### Verify:
All tests should PASS before closing.

When all tests pass, close this step:
  meow close <bead-id>
"""

[[main.steps]]
id = "refactor"
type = "task"
title = "Refactor: {{feature}}"
needs = ["make-pass"]
instructions = """
## REFACTOR Phase: Clean Up

Improve the code without changing behavior.

### Consider:
- [ ] Remove duplication
- [ ] Improve naming
- [ ] Simplify logic
- [ ] Add comments where needed

### Rules:
- Tests must still pass after refactoring
- Small changes, run tests frequently
- If unsure, skip refactoring

When done (or nothing to refactor), close this step:
  meow close <bead-id>
"""

[[main.steps]]
id = "commit"
type = "task"
title = "Commit: {{feature}}"
needs = ["refactor"]
instructions = """
## Commit Changes

Create a commit for this feature.

### Steps:
1. Stage changes: git add -A
2. Review: git diff --staged
3. Commit with descriptive message

### Commit Message Format:
feat(<scope>): <description>

- What was added
- Why it was needed

When committed, close this step:
  meow close <bead-id>
"""

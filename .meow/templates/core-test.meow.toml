# Core MEOW Functionality Test
# Tests: shell steps with output capture, branch conditions
#
# This doesn't spawn Claude - it tests the orchestrator primitives directly.

[main]
name = "core-test"
description = "Test core MEOW primitives without agent spawning"

[main.variables]
test_name = { default = "basic", description = "Name for this test run" }

# Step 1: Shell step that runs setup
[[main.steps]]
id = "setup"
executor = "shell"
description = "Setup test: {{test_name}}"
command = """
echo "Test run: {{test_name}}"
echo "Started at: $(date)"
echo "success"
"""

# Step 2: Branch that checks if marker exists
[[main.steps]]
id = "check-setup"
executor = "branch"
description = "Verify setup succeeded"
needs = ["setup"]

[main.steps.branch]
condition = "test -f /tmp/meow-test-marker"

[main.steps.branch.on_true]
inline = []

[main.steps.branch.on_false]
inline = [
    { id = "create-marker", executor = "shell", command = "touch /tmp/meow-test-marker && echo 'Marker created'" }
]

# Step 3: Final verification shell step
[[main.steps]]
id = "final-check"
executor = "shell"
description = "Final verification"
needs = ["check-setup"]
command = """
echo "=== MEOW Core Test Complete ==="
echo "Test: {{test_name}}"
echo "Marker exists: $(test -f /tmp/meow-test-marker && echo 'yes' || echo 'no')"
echo "Timestamp: $(date)"
rm -f /tmp/meow-test-marker
"""
